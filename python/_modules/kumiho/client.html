

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>kumiho.client &mdash; Kumiho Python SDK v0.3.0</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=e259d695"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Kumiho Python SDK
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#authentication">Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#using-the-cli">Using the CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#programmatic-authentication">Programmatic Authentication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#basic-concepts">Basic Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#projects">Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#groups">Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#products">Products</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#versions">Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#resources">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#links">Links</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#kref-uris">Kref URIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#error-handling">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Core Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#graph-native-architecture">Graph-Native Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#entity-hierarchy">Entity Hierarchy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#project">Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#group">Group</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#product">Product</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#version">Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#resource">Resource</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#link">Link</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#graph-traversal">Graph Traversal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#collection">Collection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#metadata">Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#setting-metadata">Setting Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#granular-attribute-operations">Granular Attribute Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#common-metadata-patterns">Common Metadata Patterns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#kref-uri-scheme">Kref URI Scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#byo-storage-philosophy">BYO Storage Philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#multi-tenant-architecture">Multi-Tenant Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#event-streaming">Event Streaming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../authentication.html">Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#cli-authentication">CLI Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#cached-credentials">Cached Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#refreshing-tokens">Refreshing Tokens</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#programmatic-authentication">Programmatic Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#with-firebase-id-token">With Firebase ID Token</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#with-environment-variables">With Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#future-authentication-methods">Future Authentication Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#discovery-flow">Discovery Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#discovery-response">Discovery Response</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#token-refresh">Token Refresh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#multiple-tenants">Multiple Tenants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#security-best-practices">Security Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#token-expired">Token Expired</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#invalid-tenant">Invalid Tenant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#connection-failed">Connection Failed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/kumiho.html">kumiho</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.__version__"><code class="docutils literal notranslate"><span class="pre">__version__</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.LATEST_TAG"><code class="docutils literal notranslate"><span class="pre">LATEST_TAG</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.PUBLISHED_TAG"><code class="docutils literal notranslate"><span class="pre">PUBLISHED_TAG</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.KumihoObject"><code class="docutils literal notranslate"><span class="pre">KumihoObject</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.KumihoObject._client"><code class="docutils literal notranslate"><span class="pre">KumihoObject._client</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.KumihoObject.__init__"><code class="docutils literal notranslate"><span class="pre">KumihoObject.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.KumihoError"><code class="docutils literal notranslate"><span class="pre">KumihoError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project"><code class="docutils literal notranslate"><span class="pre">Project</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.project_id"><code class="docutils literal notranslate"><span class="pre">Project.project_id</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.name"><code class="docutils literal notranslate"><span class="pre">Project.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.description"><code class="docutils literal notranslate"><span class="pre">Project.description</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.created_at"><code class="docutils literal notranslate"><span class="pre">Project.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.updated_at"><code class="docutils literal notranslate"><span class="pre">Project.updated_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.deprecated"><code class="docutils literal notranslate"><span class="pre">Project.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.allow_public"><code class="docutils literal notranslate"><span class="pre">Project.allow_public</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.__init__"><code class="docutils literal notranslate"><span class="pre">Project.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.__repr__"><code class="docutils literal notranslate"><span class="pre">Project.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.create_collection"><code class="docutils literal notranslate"><span class="pre">Project.create_collection()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.create_group"><code class="docutils literal notranslate"><span class="pre">Project.create_group()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.delete"><code class="docutils literal notranslate"><span class="pre">Project.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.get_group"><code class="docutils literal notranslate"><span class="pre">Project.get_group()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.get_groups"><code class="docutils literal notranslate"><span class="pre">Project.get_groups()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.set_public"><code class="docutils literal notranslate"><span class="pre">Project.set_public()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.update"><code class="docutils literal notranslate"><span class="pre">Project.update()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group"><code class="docutils literal notranslate"><span class="pre">Group</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.path"><code class="docutils literal notranslate"><span class="pre">Group.path</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.name"><code class="docutils literal notranslate"><span class="pre">Group.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.type"><code class="docutils literal notranslate"><span class="pre">Group.type</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.created_at"><code class="docutils literal notranslate"><span class="pre">Group.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.author"><code class="docutils literal notranslate"><span class="pre">Group.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.metadata"><code class="docutils literal notranslate"><span class="pre">Group.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.username"><code class="docutils literal notranslate"><span class="pre">Group.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.__init__"><code class="docutils literal notranslate"><span class="pre">Group.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.__repr__"><code class="docutils literal notranslate"><span class="pre">Group.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.create_collection"><code class="docutils literal notranslate"><span class="pre">Group.create_collection()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.create_group"><code class="docutils literal notranslate"><span class="pre">Group.create_group()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.create_product"><code class="docutils literal notranslate"><span class="pre">Group.create_product()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.delete"><code class="docutils literal notranslate"><span class="pre">Group.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.delete_attribute"><code class="docutils literal notranslate"><span class="pre">Group.delete_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.get_attribute"><code class="docutils literal notranslate"><span class="pre">Group.get_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.get_child_groups"><code class="docutils literal notranslate"><span class="pre">Group.get_child_groups()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.get_group"><code class="docutils literal notranslate"><span class="pre">Group.get_group()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.get_groups"><code class="docutils literal notranslate"><span class="pre">Group.get_groups()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.get_parent_group"><code class="docutils literal notranslate"><span class="pre">Group.get_parent_group()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.get_product"><code class="docutils literal notranslate"><span class="pre">Group.get_product()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.get_products"><code class="docutils literal notranslate"><span class="pre">Group.get_products()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.get_project"><code class="docutils literal notranslate"><span class="pre">Group.get_project()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.set_attribute"><code class="docutils literal notranslate"><span class="pre">Group.set_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Group.set_metadata"><code class="docutils literal notranslate"><span class="pre">Group.set_metadata()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product"><code class="docutils literal notranslate"><span class="pre">Product</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.kref"><code class="docutils literal notranslate"><span class="pre">Product.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.name"><code class="docutils literal notranslate"><span class="pre">Product.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.product_name"><code class="docutils literal notranslate"><span class="pre">Product.product_name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.product_type"><code class="docutils literal notranslate"><span class="pre">Product.product_type</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.created_at"><code class="docutils literal notranslate"><span class="pre">Product.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.author"><code class="docutils literal notranslate"><span class="pre">Product.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.metadata"><code class="docutils literal notranslate"><span class="pre">Product.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.deprecated"><code class="docutils literal notranslate"><span class="pre">Product.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.username"><code class="docutils literal notranslate"><span class="pre">Product.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.__init__"><code class="docutils literal notranslate"><span class="pre">Product.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.__repr__"><code class="docutils literal notranslate"><span class="pre">Product.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.create_version"><code class="docutils literal notranslate"><span class="pre">Product.create_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.delete"><code class="docutils literal notranslate"><span class="pre">Product.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.delete_attribute"><code class="docutils literal notranslate"><span class="pre">Product.delete_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.get_attribute"><code class="docutils literal notranslate"><span class="pre">Product.get_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.get_group"><code class="docutils literal notranslate"><span class="pre">Product.get_group()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.get_latest_version"><code class="docutils literal notranslate"><span class="pre">Product.get_latest_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.get_project"><code class="docutils literal notranslate"><span class="pre">Product.get_project()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.get_version"><code class="docutils literal notranslate"><span class="pre">Product.get_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.get_version_by_tag"><code class="docutils literal notranslate"><span class="pre">Product.get_version_by_tag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.get_version_by_time"><code class="docutils literal notranslate"><span class="pre">Product.get_version_by_time()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.get_versions"><code class="docutils literal notranslate"><span class="pre">Product.get_versions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.peek_next_version"><code class="docutils literal notranslate"><span class="pre">Product.peek_next_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.set_attribute"><code class="docutils literal notranslate"><span class="pre">Product.set_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.set_deprecated"><code class="docutils literal notranslate"><span class="pre">Product.set_deprecated()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Product.set_metadata"><code class="docutils literal notranslate"><span class="pre">Product.set_metadata()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version"><code class="docutils literal notranslate"><span class="pre">Version</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.kref"><code class="docutils literal notranslate"><span class="pre">Version.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.product_kref"><code class="docutils literal notranslate"><span class="pre">Version.product_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.number"><code class="docutils literal notranslate"><span class="pre">Version.number</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.latest"><code class="docutils literal notranslate"><span class="pre">Version.latest</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.tags"><code class="docutils literal notranslate"><span class="pre">Version.tags</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.metadata"><code class="docutils literal notranslate"><span class="pre">Version.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.created_at"><code class="docutils literal notranslate"><span class="pre">Version.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.author"><code class="docutils literal notranslate"><span class="pre">Version.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.deprecated"><code class="docutils literal notranslate"><span class="pre">Version.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.published"><code class="docutils literal notranslate"><span class="pre">Version.published</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.username"><code class="docutils literal notranslate"><span class="pre">Version.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.default_resource"><code class="docutils literal notranslate"><span class="pre">Version.default_resource</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.__init__"><code class="docutils literal notranslate"><span class="pre">Version.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.__repr__"><code class="docutils literal notranslate"><span class="pre">Version.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.analyze_impact"><code class="docutils literal notranslate"><span class="pre">Version.analyze_impact()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.create_link"><code class="docutils literal notranslate"><span class="pre">Version.create_link()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.create_resource"><code class="docutils literal notranslate"><span class="pre">Version.create_resource()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.delete"><code class="docutils literal notranslate"><span class="pre">Version.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.delete_attribute"><code class="docutils literal notranslate"><span class="pre">Version.delete_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.delete_link"><code class="docutils literal notranslate"><span class="pre">Version.delete_link()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.find_path_to"><code class="docutils literal notranslate"><span class="pre">Version.find_path_to()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_all_dependencies"><code class="docutils literal notranslate"><span class="pre">Version.get_all_dependencies()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_all_dependents"><code class="docutils literal notranslate"><span class="pre">Version.get_all_dependents()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_attribute"><code class="docutils literal notranslate"><span class="pre">Version.get_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_group"><code class="docutils literal notranslate"><span class="pre">Version.get_group()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_links"><code class="docutils literal notranslate"><span class="pre">Version.get_links()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_locations"><code class="docutils literal notranslate"><span class="pre">Version.get_locations()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_product"><code class="docutils literal notranslate"><span class="pre">Version.get_product()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_project"><code class="docutils literal notranslate"><span class="pre">Version.get_project()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_resource"><code class="docutils literal notranslate"><span class="pre">Version.get_resource()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.get_resources"><code class="docutils literal notranslate"><span class="pre">Version.get_resources()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.has_tag"><code class="docutils literal notranslate"><span class="pre">Version.has_tag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.refresh"><code class="docutils literal notranslate"><span class="pre">Version.refresh()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.set_attribute"><code class="docutils literal notranslate"><span class="pre">Version.set_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.set_default_resource"><code class="docutils literal notranslate"><span class="pre">Version.set_default_resource()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.set_deprecated"><code class="docutils literal notranslate"><span class="pre">Version.set_deprecated()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.set_metadata"><code class="docutils literal notranslate"><span class="pre">Version.set_metadata()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.tag"><code class="docutils literal notranslate"><span class="pre">Version.tag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id0"><code class="docutils literal notranslate"><span class="pre">Version.tags</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.untag"><code class="docutils literal notranslate"><span class="pre">Version.untag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Version.was_tagged"><code class="docutils literal notranslate"><span class="pre">Version.was_tagged()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource"><code class="docutils literal notranslate"><span class="pre">Resource</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.kref"><code class="docutils literal notranslate"><span class="pre">Resource.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.location"><code class="docutils literal notranslate"><span class="pre">Resource.location</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.version_kref"><code class="docutils literal notranslate"><span class="pre">Resource.version_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.product_kref"><code class="docutils literal notranslate"><span class="pre">Resource.product_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.created_at"><code class="docutils literal notranslate"><span class="pre">Resource.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.author"><code class="docutils literal notranslate"><span class="pre">Resource.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.metadata"><code class="docutils literal notranslate"><span class="pre">Resource.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.deprecated"><code class="docutils literal notranslate"><span class="pre">Resource.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.username"><code class="docutils literal notranslate"><span class="pre">Resource.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.__init__"><code class="docutils literal notranslate"><span class="pre">Resource.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.__repr__"><code class="docutils literal notranslate"><span class="pre">Resource.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.delete"><code class="docutils literal notranslate"><span class="pre">Resource.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.delete_attribute"><code class="docutils literal notranslate"><span class="pre">Resource.delete_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.get_attribute"><code class="docutils literal notranslate"><span class="pre">Resource.get_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.get_group"><code class="docutils literal notranslate"><span class="pre">Resource.get_group()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.get_product"><code class="docutils literal notranslate"><span class="pre">Resource.get_product()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.get_project"><code class="docutils literal notranslate"><span class="pre">Resource.get_project()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.get_version"><code class="docutils literal notranslate"><span class="pre">Resource.get_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.name"><code class="docutils literal notranslate"><span class="pre">Resource.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.set_attribute"><code class="docutils literal notranslate"><span class="pre">Resource.set_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.set_default"><code class="docutils literal notranslate"><span class="pre">Resource.set_default()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.set_deprecated"><code class="docutils literal notranslate"><span class="pre">Resource.set_deprecated()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Resource.set_metadata"><code class="docutils literal notranslate"><span class="pre">Resource.set_metadata()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link"><code class="docutils literal notranslate"><span class="pre">Link</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.source_kref"><code class="docutils literal notranslate"><span class="pre">Link.source_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.target_kref"><code class="docutils literal notranslate"><span class="pre">Link.target_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.link_type"><code class="docutils literal notranslate"><span class="pre">Link.link_type</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.metadata"><code class="docutils literal notranslate"><span class="pre">Link.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.created_at"><code class="docutils literal notranslate"><span class="pre">Link.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.author"><code class="docutils literal notranslate"><span class="pre">Link.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.username"><code class="docutils literal notranslate"><span class="pre">Link.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.__init__"><code class="docutils literal notranslate"><span class="pre">Link.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.__repr__"><code class="docutils literal notranslate"><span class="pre">Link.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Link.delete"><code class="docutils literal notranslate"><span class="pre">Link.delete()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref"><code class="docutils literal notranslate"><span class="pre">Kref</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.uri"><code class="docutils literal notranslate"><span class="pre">Kref.uri</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.__eq__"><code class="docutils literal notranslate"><span class="pre">Kref.__eq__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.__hash__"><code class="docutils literal notranslate"><span class="pre">Kref.__hash__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.__new__"><code class="docutils literal notranslate"><span class="pre">Kref.__new__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.__repr__"><code class="docutils literal notranslate"><span class="pre">Kref.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.from_pb"><code class="docutils literal notranslate"><span class="pre">Kref.from_pb()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_group"><code class="docutils literal notranslate"><span class="pre">Kref.get_group()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_path"><code class="docutils literal notranslate"><span class="pre">Kref.get_path()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_product_name"><code class="docutils literal notranslate"><span class="pre">Kref.get_product_name()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_resource_name"><code class="docutils literal notranslate"><span class="pre">Kref.get_resource_name()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_type"><code class="docutils literal notranslate"><span class="pre">Kref.get_type()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_version"><code class="docutils literal notranslate"><span class="pre">Kref.get_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.to_pb"><code class="docutils literal notranslate"><span class="pre">Kref.to_pb()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id1"><code class="docutils literal notranslate"><span class="pre">Kref.uri</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event"><code class="docutils literal notranslate"><span class="pre">Event</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.routing_key"><code class="docutils literal notranslate"><span class="pre">Event.routing_key</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.kref"><code class="docutils literal notranslate"><span class="pre">Event.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.timestamp"><code class="docutils literal notranslate"><span class="pre">Event.timestamp</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.author"><code class="docutils literal notranslate"><span class="pre">Event.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.details"><code class="docutils literal notranslate"><span class="pre">Event.details</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.__init__"><code class="docutils literal notranslate"><span class="pre">Event.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.__repr__"><code class="docutils literal notranslate"><span class="pre">Event.__repr__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.ProjectLimitError"><code class="docutils literal notranslate"><span class="pre">ProjectLimitError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection"><code class="docutils literal notranslate"><span class="pre">Collection</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.kref"><code class="docutils literal notranslate"><span class="pre">Collection.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.name"><code class="docutils literal notranslate"><span class="pre">Collection.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.product_name"><code class="docutils literal notranslate"><span class="pre">Collection.product_name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.product_type"><code class="docutils literal notranslate"><span class="pre">Collection.product_type</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.metadata"><code class="docutils literal notranslate"><span class="pre">Collection.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.created_at"><code class="docutils literal notranslate"><span class="pre">Collection.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.author"><code class="docutils literal notranslate"><span class="pre">Collection.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.username"><code class="docutils literal notranslate"><span class="pre">Collection.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.deprecated"><code class="docutils literal notranslate"><span class="pre">Collection.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.__init__"><code class="docutils literal notranslate"><span class="pre">Collection.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.__repr__"><code class="docutils literal notranslate"><span class="pre">Collection.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.add_member"><code class="docutils literal notranslate"><span class="pre">Collection.add_member()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.get_history"><code class="docutils literal notranslate"><span class="pre">Collection.get_history()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.get_members"><code class="docutils literal notranslate"><span class="pre">Collection.get_members()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Collection.remove_member"><code class="docutils literal notranslate"><span class="pre">Collection.remove_member()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionMember"><code class="docutils literal notranslate"><span class="pre">CollectionMember</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionMember.product_kref"><code class="docutils literal notranslate"><span class="pre">CollectionMember.product_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionMember.added_at"><code class="docutils literal notranslate"><span class="pre">CollectionMember.added_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionMember.added_by"><code class="docutils literal notranslate"><span class="pre">CollectionMember.added_by</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionMember.added_by_username"><code class="docutils literal notranslate"><span class="pre">CollectionMember.added_by_username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionMember.added_in_version"><code class="docutils literal notranslate"><span class="pre">CollectionMember.added_in_version</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionMember.__init__"><code class="docutils literal notranslate"><span class="pre">CollectionMember.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id2"><code class="docutils literal notranslate"><span class="pre">CollectionMember.product_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id3"><code class="docutils literal notranslate"><span class="pre">CollectionMember.added_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id4"><code class="docutils literal notranslate"><span class="pre">CollectionMember.added_by</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id5"><code class="docutils literal notranslate"><span class="pre">CollectionMember.added_by_username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id6"><code class="docutils literal notranslate"><span class="pre">CollectionMember.added_in_version</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionVersionHistory"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionVersionHistory.version_number"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.version_number</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionVersionHistory.action"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.action</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionVersionHistory.member_product_kref"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.member_product_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionVersionHistory.author"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionVersionHistory.username"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionVersionHistory.created_at"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionVersionHistory.metadata"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.CollectionVersionHistory.__init__"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id7"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.version_number</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id8"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.action</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id9"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.member_product_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id10"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id11"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id12"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id13"><code class="docutils literal notranslate"><span class="pre">CollectionVersionHistory.metadata</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.ReservedProductTypeError"><code class="docutils literal notranslate"><span class="pre">ReservedProductTypeError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.KrefValidationError"><code class="docutils literal notranslate"><span class="pre">KrefValidationError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkTypeValidationError"><code class="docutils literal notranslate"><span class="pre">LinkTypeValidationError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.validate_kref"><code class="docutils literal notranslate"><span class="pre">validate_kref()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.validate_link_type"><code class="docutils literal notranslate"><span class="pre">validate_link_type()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.is_valid_kref"><code class="docutils literal notranslate"><span class="pre">is_valid_kref()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.is_valid_link_type"><code class="docutils literal notranslate"><span class="pre">is_valid_link_type()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.connect"><code class="docutils literal notranslate"><span class="pre">connect()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.use_client"><code class="docutils literal notranslate"><span class="pre">use_client</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.use_client.__init__"><code class="docutils literal notranslate"><span class="pre">use_client.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.use_client.__enter__"><code class="docutils literal notranslate"><span class="pre">use_client.__enter__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.use_client.__exit__"><code class="docutils literal notranslate"><span class="pre">use_client.__exit__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_client"><code class="docutils literal notranslate"><span class="pre">get_client()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.configure_default_client"><code class="docutils literal notranslate"><span class="pre">configure_default_client()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.auto_configure_from_discovery"><code class="docutils literal notranslate"><span class="pre">auto_configure_from_discovery()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#id14"><code class="docutils literal notranslate"><span class="pre">LATEST_TAG</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#id15"><code class="docutils literal notranslate"><span class="pre">PUBLISHED_TAG</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkType"><code class="docutils literal notranslate"><span class="pre">LinkType</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkType.BELONGS_TO"><code class="docutils literal notranslate"><span class="pre">LinkType.BELONGS_TO</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkType.CREATED_FROM"><code class="docutils literal notranslate"><span class="pre">LinkType.CREATED_FROM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkType.REFERENCED"><code class="docutils literal notranslate"><span class="pre">LinkType.REFERENCED</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkType.DEPENDS_ON"><code class="docutils literal notranslate"><span class="pre">LinkType.DEPENDS_ON</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkType.DERIVED_FROM"><code class="docutils literal notranslate"><span class="pre">LinkType.DERIVED_FROM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkType.CONTAINS"><code class="docutils literal notranslate"><span class="pre">LinkType.CONTAINS</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id16"><code class="docutils literal notranslate"><span class="pre">LinkType.BELONGS_TO</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id17"><code class="docutils literal notranslate"><span class="pre">LinkType.CONTAINS</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id18"><code class="docutils literal notranslate"><span class="pre">LinkType.CREATED_FROM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id19"><code class="docutils literal notranslate"><span class="pre">LinkType.DEPENDS_ON</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id20"><code class="docutils literal notranslate"><span class="pre">LinkType.DERIVED_FROM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id21"><code class="docutils literal notranslate"><span class="pre">LinkType.REFERENCED</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkDirection"><code class="docutils literal notranslate"><span class="pre">LinkDirection</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkDirection.OUTGOING"><code class="docutils literal notranslate"><span class="pre">LinkDirection.OUTGOING</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkDirection.INCOMING"><code class="docutils literal notranslate"><span class="pre">LinkDirection.INCOMING</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.LinkDirection.BOTH"><code class="docutils literal notranslate"><span class="pre">LinkDirection.BOTH</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id22"><code class="docutils literal notranslate"><span class="pre">LinkDirection.BOTH</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id23"><code class="docutils literal notranslate"><span class="pre">LinkDirection.INCOMING</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id24"><code class="docutils literal notranslate"><span class="pre">LinkDirection.OUTGOING</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.create_project"><code class="docutils literal notranslate"><span class="pre">create_project()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_projects"><code class="docutils literal notranslate"><span class="pre">get_projects()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_project"><code class="docutils literal notranslate"><span class="pre">get_project()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.delete_project"><code class="docutils literal notranslate"><span class="pre">delete_project()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.product_search"><code class="docutils literal notranslate"><span class="pre">product_search()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_product"><code class="docutils literal notranslate"><span class="pre">get_product()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_version"><code class="docutils literal notranslate"><span class="pre">get_version()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_resource"><code class="docutils literal notranslate"><span class="pre">get_resource()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_resources_by_location"><code class="docutils literal notranslate"><span class="pre">get_resources_by_location()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.set_attribute"><code class="docutils literal notranslate"><span class="pre">set_attribute()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_attribute"><code class="docutils literal notranslate"><span class="pre">get_attribute()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.delete_attribute"><code class="docutils literal notranslate"><span class="pre">delete_attribute()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.event_stream"><code class="docutils literal notranslate"><span class="pre">event_stream()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.resolve"><code class="docutils literal notranslate"><span class="pre">resolve()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/project.html">kumiho.project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/group.html">kumiho.group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/product.html">kumiho.product</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/collection.html">kumiho.collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/version.html">kumiho.version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/resource.html">kumiho.resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/link.html">kumiho.link</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kref.html">kumiho.kref</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#xx-xx">[0.3.0] - 2024-XX-XX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#added">Added</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#changed">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#fixed">Fixed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id1">[0.2.0] - 2024-XX-XX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id2">Added</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id3">Changed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id4">[0.1.0] - 2024-XX-XX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id5">Added</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#development-setup">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#code-style">Code Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#pull-request-process">Pull Request Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#license">License</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Kumiho Python SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../kumiho.html">kumiho</a></li>
      <li class="breadcrumb-item active">kumiho.client</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for kumiho.client</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Low-level gRPC client for the Kumiho Cloud service.</span>

<span class="sd">This module provides the internal ``_Client`` class that handles all gRPC</span>
<span class="sd">communication with Kumiho Cloud servers. It manages:</span>

<span class="sd">- Connection establishment (TLS/insecure, target resolution)</span>
<span class="sd">- Authentication (Bearer token injection)</span>
<span class="sd">- Discovery-based tenant routing</span>
<span class="sd">- All gRPC method calls</span>

<span class="sd">The ``_Client`` class is not intended to be used directly by end users.</span>
<span class="sd">Instead, use the high-level functions and classes exposed by the ``kumiho``</span>
<span class="sd">package, such as :func:`kumiho.connect`, :class:`kumiho.Project`, etc.</span>

<span class="sd">Example:</span>
<span class="sd">    Internal usage (not recommended for end users)::</span>

<span class="sd">        from kumiho.client import _Client</span>

<span class="sd">        client = _Client(target=&quot;us-central.kumiho.cloud:443&quot;)</span>
<span class="sd">        group = client.create_group(project_kref, &quot;my-group&quot;)</span>

<span class="sd">    Preferred high-level usage::</span>

<span class="sd">        import kumiho</span>

<span class="sd">        kumiho.connect()</span>
<span class="sd">        project = kumiho.create_project(name=&quot;my-project&quot;)</span>

<span class="sd">Attributes:</span>
<span class="sd">    _LOGGER: Module-level logger for client operations.</span>
<span class="sd">    _DISCOVERY_DISABLE_ENV: Environment variable to disable auto-discovery.</span>
<span class="sd">    _FORCE_REFRESH_ENV: Environment variable to force discovery cache refresh.</span>

<span class="sd">Note:</span>
<span class="sd">    This module is considered internal API. The public interface may change</span>
<span class="sd">    between minor versions. Use the ``kumiho`` package-level API instead.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">grpc</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">google.protobuf.json_format</span><span class="w"> </span><span class="kn">import</span> <span class="n">MessageToDict</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">._token_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_bearer_token</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.discovery</span><span class="w"> </span><span class="kn">import</span> <span class="n">DiscoveryError</span><span class="p">,</span> <span class="n">DiscoveryManager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.proto</span><span class="w"> </span><span class="kn">import</span> <span class="n">kumiho_pb2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.proto</span><span class="w"> </span><span class="kn">import</span> <span class="n">kumiho_pb2_grpc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.event</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.group</span><span class="w"> </span><span class="kn">import</span> <span class="n">Group</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.kref</span><span class="w"> </span><span class="kn">import</span> <span class="n">Kref</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.proto.kumiho_pb2</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">CreateGroupRequest</span><span class="p">,</span>
    <span class="n">CreateLinkRequest</span><span class="p">,</span>
    <span class="n">CreateProductRequest</span><span class="p">,</span>
    <span class="n">CreateResourceRequest</span><span class="p">,</span>
    <span class="n">CreateVersionRequest</span><span class="p">,</span>
    <span class="n">CreateProjectRequest</span><span class="p">,</span>
    <span class="n">DeleteGroupRequest</span><span class="p">,</span>
    <span class="n">DeleteLinkRequest</span><span class="p">,</span>
    <span class="n">DeleteProductRequest</span><span class="p">,</span>
    <span class="n">DeleteResourceRequest</span><span class="p">,</span>
    <span class="n">DeleteVersionRequest</span><span class="p">,</span>
    <span class="n">DeleteProjectRequest</span><span class="p">,</span>
    <span class="n">DeleteAttributeRequest</span><span class="p">,</span>
    <span class="n">EventStreamRequest</span><span class="p">,</span>
    <span class="n">GetAttributeRequest</span><span class="p">,</span>
    <span class="n">GetChildGroupsRequest</span><span class="p">,</span>
    <span class="n">GetGroupRequest</span><span class="p">,</span>
    <span class="n">GetLinksRequest</span><span class="p">,</span>
    <span class="n">GetProductRequest</span><span class="p">,</span>
    <span class="n">GetProductsRequest</span><span class="p">,</span>
    <span class="n">GetProjectsRequest</span><span class="p">,</span>
    <span class="n">GetResourceRequest</span><span class="p">,</span>
    <span class="n">GetResourcesRequest</span><span class="p">,</span>
    <span class="n">GetResourcesByLocationRequest</span><span class="p">,</span>
    <span class="n">GetTenantUsageRequest</span><span class="p">,</span>
    <span class="n">GetVersionsRequest</span><span class="p">,</span>
    <span class="n">HasTagRequest</span><span class="p">,</span>
    <span class="n">KrefRequest</span><span class="p">,</span>
    <span class="n">Link</span> <span class="k">as</span> <span class="n">PbLink</span><span class="p">,</span>
    <span class="n">LinkDirection</span><span class="p">,</span>
    <span class="n">PeekNextVersionRequest</span><span class="p">,</span>
    <span class="n">ProductSearchRequest</span><span class="p">,</span>
    <span class="n">ResolveKrefRequest</span><span class="p">,</span>
    <span class="n">ResolveLocationRequest</span><span class="p">,</span>
    <span class="n">SetAttributeRequest</span><span class="p">,</span>
    <span class="n">SetDefaultResourceRequest</span><span class="p">,</span>
    <span class="n">TagVersionRequest</span><span class="p">,</span>
    <span class="n">UnTagVersionRequest</span><span class="p">,</span>
    <span class="n">UpdateMetadataRequest</span><span class="p">,</span>
    <span class="n">WasTaggedRequest</span><span class="p">,</span>
    <span class="n">SetDeprecatedRequest</span><span class="p">,</span>
    <span class="n">TraverseLinksRequest</span><span class="p">,</span>
    <span class="n">ShortestPathRequest</span><span class="p">,</span>
    <span class="n">ImpactAnalysisRequest</span><span class="p">,</span>
    <span class="n">CreateCollectionRequest</span><span class="p">,</span>
    <span class="n">AddCollectionMemberRequest</span><span class="p">,</span>
    <span class="n">RemoveCollectionMemberRequest</span><span class="p">,</span>
    <span class="n">GetCollectionMembersRequest</span><span class="p">,</span>
    <span class="n">GetCollectionHistoryRequest</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.link</span><span class="w"> </span><span class="kn">import</span> <span class="n">Link</span><span class="p">,</span> <span class="n">TraversalResult</span><span class="p">,</span> <span class="n">ImpactedVersion</span><span class="p">,</span> <span class="n">ShortestPathResult</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.proto.kumiho_pb2</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProjectResponse</span><span class="p">,</span> <span class="n">StatusResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.project</span><span class="w"> </span><span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.product</span><span class="w"> </span><span class="kn">import</span> <span class="n">Product</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.resource</span><span class="w"> </span><span class="kn">import</span> <span class="n">Resource</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">Version</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.collection</span><span class="w"> </span><span class="kn">import</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">CollectionMember</span><span class="p">,</span> <span class="n">CollectionVersionHistory</span>


<span class="n">_LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;kumiho.client&quot;</span><span class="p">)</span>
<span class="n">_DISCOVERY_DISABLE_ENV</span> <span class="o">=</span> <span class="s2">&quot;KUMIHO_DISABLE_AUTO_DISCOVERY&quot;</span>
<span class="n">_FORCE_REFRESH_ENV</span> <span class="o">=</span> <span class="s2">&quot;KUMIHO_FORCE_DISCOVERY_REFRESH&quot;</span>


<div class="viewcode-block" id="ProjectLimitError">
<a class="viewcode-back" href="../../api/kumiho.html#kumiho.ProjectLimitError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ProjectLimitError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when guardrails block project creation (e.g., max projects reached).&quot;&quot;&quot;</span></div>



<span class="k">class</span><span class="w"> </span><span class="nc">_Client</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Low-level gRPC client for interacting with the Kumiho Cloud service.</span>

<span class="sd">    This client provides direct access to all Kumiho gRPC endpoints for</span>
<span class="sd">    managing projects, groups, products, versions, resources, and links.</span>
<span class="sd">    It handles connection management, authentication, and discovery-based</span>
<span class="sd">    tenant routing automatically.</span>

<span class="sd">    The client is typically not instantiated directly. Instead, use</span>
<span class="sd">    :func:`kumiho.connect` which manages a context-variable-scoped client</span>
<span class="sd">    instance.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        channel (grpc.Channel): The gRPC channel to the Kumiho server.</span>
<span class="sd">        stub (KumihoGraphStub): The gRPC stub for making service calls.</span>

<span class="sd">    Example:</span>
<span class="sd">        Using the client directly (not recommended)::</span>

<span class="sd">            from kumiho.client import _Client</span>

<span class="sd">            client = _Client(</span>
<span class="sd">                target=&quot;us-central.kumiho.cloud:443&quot;,</span>
<span class="sd">                auth_token=&quot;eyJhbG...&quot;</span>
<span class="sd">            )</span>
<span class="sd">            projects = client.get_projects()</span>

<span class="sd">        Using via kumiho.connect (recommended)::</span>

<span class="sd">            import kumiho</span>

<span class="sd">            kumiho.connect()</span>
<span class="sd">            projects = kumiho.list_projects()</span>

<span class="sd">    Note:</span>
<span class="sd">        This class is considered internal API. Use the public ``kumiho``</span>
<span class="sd">        module functions instead for stable interfaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">auth_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_discovery</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tenant_hint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_discovery_refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">enable_auto_login</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the gRPC client with connection and authentication settings.</span>

<span class="sd">        The client resolves the target server using the following priority:</span>

<span class="sd">        1. Explicit ``target`` parameter</span>
<span class="sd">        2. Discovery endpoint (if enabled and token available)</span>
<span class="sd">        3. ``KUMIHO_SERVER_ENDPOINT`` environment variable</span>
<span class="sd">        4. ``KUMIHO_SERVER_ADDRESS`` environment variable (legacy)</span>
<span class="sd">        5. ``localhost:8080`` (default for local development)</span>

<span class="sd">        Args:</span>
<span class="sd">            target: Server endpoint. Accepts formats:</span>

<span class="sd">                - ``host:port``  plain gRPC</span>
<span class="sd">                - ``https://host``  secure gRPC on port 443</span>
<span class="sd">                - ``grpcs://host:port``  secure gRPC on custom port</span>

<span class="sd">                If None, the client attempts discovery or falls back to</span>
<span class="sd">                environment variables.</span>
<span class="sd">            auth_token: Bearer token for authentication. Sent as</span>
<span class="sd">                ``Authorization: Bearer &lt;token&gt;`` on every RPC. If not</span>
<span class="sd">                provided, falls back to:</span>

<span class="sd">                - ``KUMIHO_AUTH_TOKEN`` environment variable</span>
<span class="sd">                - Token file from ``kumiho-auth`` CLI cache</span>
<span class="sd">            default_metadata: Additional gRPC metadata to attach to all</span>
<span class="sd">                outbound RPCs. Each entry is a ``(key, value)`` tuple.</span>
<span class="sd">            use_discovery: Whether to use the discovery endpoint for</span>
<span class="sd">                tenant routing. Defaults to True unless disabled via</span>
<span class="sd">                ``KUMIHO_DISABLE_AUTO_DISCOVERY=true``.</span>
<span class="sd">            tenant_hint: Optional tenant ID hint for discovery or direct</span>
<span class="sd">                tenant header injection when discovery is disabled.</span>
<span class="sd">            force_discovery_refresh: Force refresh of discovery cache.</span>
<span class="sd">                Overrides ``KUMIHO_FORCE_DISCOVERY_REFRESH`` env var.</span>
<span class="sd">            enable_auto_login: Whether to enable auto-login when no</span>
<span class="sd">                credentials are available. Defaults to True.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the connection cannot be established.</span>
<span class="sd">            DiscoveryError: If discovery fails and no fallback is available.</span>

<span class="sd">        Example:</span>
<span class="sd">            Basic initialization::</span>

<span class="sd">                client = _Client()  # Uses defaults</span>

<span class="sd">            With explicit settings::</span>

<span class="sd">                client = _Client(</span>
<span class="sd">                    target=&quot;us-central.kumiho.cloud:443&quot;,</span>
<span class="sd">                    auth_token=&quot;eyJhbG...&quot;,</span>
<span class="sd">                    default_metadata=[(&quot;x-custom-header&quot;, &quot;value&quot;)]</span>
<span class="sd">                )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">default_metadata</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="n">resolved_token</span> <span class="o">=</span> <span class="n">auth_token</span> <span class="ow">or</span> <span class="n">load_bearer_token</span><span class="p">()</span>

        <span class="n">discovery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_resolve_via_discovery</span><span class="p">(</span>
            <span class="n">explicit_target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
            <span class="n">use_discovery</span><span class="o">=</span><span class="n">use_discovery</span><span class="p">,</span>
            <span class="n">id_token</span><span class="o">=</span><span class="n">resolved_token</span><span class="p">,</span>
            <span class="n">tenant_hint</span><span class="o">=</span><span class="n">tenant_hint</span><span class="p">,</span>
            <span class="n">force_discovery_refresh</span><span class="o">=</span><span class="n">force_discovery_refresh</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tenant_header_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">discovery</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">discovery</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">discovery</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">discovery</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;x-tenant-id&quot;</span><span class="p">,</span> <span class="n">discovery</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">tenant_header_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">tenant_hint</span><span class="p">:</span>
            <span class="c1"># Fallback: if discovery didn&#39;t run (e.g. no token), use the hint directly</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;x-tenant-id&quot;</span><span class="p">,</span> <span class="n">tenant_hint</span><span class="p">))</span>
            <span class="n">tenant_header_set</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_ENDPOINT&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_ADDRESS&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="s2">&quot;localhost:8080&quot;</span>
            <span class="p">)</span>

        <span class="n">authority_override</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_AUTHORITY&quot;</span><span class="p">)</span>
        <span class="n">ssl_override</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SSL_TARGET_OVERRIDE&quot;</span><span class="p">)</span>
        <span class="n">ca_bundle</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_CA_FILE&quot;</span><span class="p">)</span>
        <span class="n">use_tls_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_USE_TLS&quot;</span><span class="p">)</span>

        <span class="n">address</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">use_tls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalise_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_tls_env</span><span class="p">:</span>
            <span class="n">use_tls</span> <span class="o">=</span> <span class="n">use_tls_env</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">authority_override</span><span class="p">:</span>
            <span class="n">authority</span> <span class="o">=</span> <span class="n">authority_override</span>

        <span class="k">if</span> <span class="n">use_tls</span><span class="p">:</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_ssl_credentials</span><span class="p">(</span><span class="n">ca_bundle</span><span class="p">)</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;grpc.default_authority&quot;</span><span class="p">,</span> <span class="n">authority</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">ssl_override</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;grpc.ssl_target_name_override&quot;</span><span class="p">,</span> <span class="n">ssl_override</span><span class="p">))</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">secure_channel</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">resolved_token</span><span class="p">:</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;authorization&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">resolved_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="c1"># Apply interceptors in order: auto-login first, then metadata injection</span>
        <span class="k">if</span> <span class="n">enable_auto_login</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">intercept_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">_AutoLoginInterceptor</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">intercept_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">_MetadataInjector</span><span class="p">(</span><span class="n">metadata</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span> <span class="o">=</span> <span class="n">kumiho_pb2_grpc</span><span class="o">.</span><span class="n">KumihoServiceStub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_env_flag</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_maybe_resolve_via_discovery</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">explicit_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">use_discovery</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
        <span class="n">id_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">tenant_hint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">force_discovery_refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="k">if</span> <span class="n">explicit_target</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">should_use</span> <span class="o">=</span> <span class="n">use_discovery</span>
        <span class="k">if</span> <span class="n">should_use</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">should_use</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_flag</span><span class="p">(</span><span class="n">_DISCOVERY_DISABLE_ENV</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">should_use</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">id_token</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Discovery skipped: no Firebase token available&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">hint</span> <span class="o">=</span> <span class="n">tenant_hint</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="n">force_refresh</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">force_discovery_refresh</span>
            <span class="k">if</span> <span class="n">force_discovery_refresh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_flag</span><span class="p">(</span><span class="n">_FORCE_REFRESH_ENV</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">manager</span> <span class="o">=</span> <span class="n">DiscoveryManager</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">record</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span>
                <span class="n">id_token</span><span class="o">=</span><span class="n">id_token</span><span class="p">,</span>
                <span class="n">tenant_hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span>
                <span class="n">force_refresh</span><span class="o">=</span><span class="n">force_refresh</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">DiscoveryError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Discovery failed (</span><span class="si">%s</span><span class="s2">); falling back to legacy target&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pragma: no cover - defensive logging</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unexpected discovery failure; falling back to legacy target&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">target</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">grpc_authority</span> <span class="ow">or</span> <span class="n">record</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">server_url</span>
        <span class="n">tenant_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">tenant_id</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Resolved Kumiho endpoint via discovery: target=</span><span class="si">%s</span><span class="s2"> tenant=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">tenant_id</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">target</span><span class="p">,</span> <span class="n">tenant_id</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_normalise_target</span><span class="p">(</span><span class="n">raw_target</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the provided target into an address, authority, and TLS flag.&quot;&quot;&quot;</span>

        <span class="n">target</span> <span class="o">=</span> <span class="n">raw_target</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Kumiho client target cannot be empty&quot;</span><span class="p">)</span>

        <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;://&quot;</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">hostname</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">port</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid Kumiho endpoint: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="s2">&quot;grpcs&quot;</span><span class="p">}:</span>
                    <span class="n">port</span> <span class="o">=</span> <span class="mi">443</span>
                <span class="k">elif</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;grpc&quot;</span><span class="p">}:</span>
                    <span class="n">port</span> <span class="o">=</span> <span class="mi">80</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="c1"># Strip any trailing path components</span>
            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
                <span class="n">host</span><span class="p">,</span> <span class="n">port_str</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">port_str</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">host</span> <span class="o">=</span> <span class="n">target</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid Kumiho endpoint: </span><span class="si">{</span><span class="n">raw_target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="mi">443</span> <span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="s2">&quot;grpcs&quot;</span><span class="p">}</span> <span class="k">else</span> <span class="mi">8080</span>

        <span class="n">authority</span> <span class="o">=</span> <span class="n">host</span>
        <span class="n">address</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">use_tls</span> <span class="o">=</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="s2">&quot;grpcs&quot;</span><span class="p">}</span> <span class="ow">or</span> <span class="n">port</span> <span class="o">==</span> <span class="mi">443</span>
        <span class="k">return</span> <span class="n">address</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">use_tls</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_ssl_credentials</span><span class="p">(</span><span class="n">ca_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ChannelCredentials</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create SSL credentials, optionally using a custom CA bundle.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ca_file</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ca_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">root_certs</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ssl_channel_credentials</span><span class="p">(</span><span class="n">root_certificates</span><span class="o">=</span><span class="n">root_certs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ssl_channel_credentials</span><span class="p">()</span>

    <span class="c1"># Project methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateProjectRequest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateProject</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">code</span><span class="p">()</span> <span class="o">==</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">RESOURCE_EXHAUSTED</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ProjectLimitError</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">details</span><span class="p">())</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">Project</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Project</span><span class="p">]:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetProjectsRequest</span><span class="p">()</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetProjects</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Project</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">pb</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">projects</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Project</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the first project matching the given name, or None if not found.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_projects</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">project</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusResponse</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteProjectRequest</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteProject</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">allow_public</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;project_id&quot;</span><span class="p">:</span> <span class="n">project_id</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">allow_public</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;allow_public&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">allow_public</span>
        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kumiho_pb2</span><span class="o">.</span><span class="n">UpdateProjectRequest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateProject</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Project</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Group methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Group</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new group.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent group.</span>
<span class="sd">            group_name: The name of the new group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Group object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateGroupRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateGroup</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Group</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Group</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a group by its path.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path of the group to retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Group object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetGroupRequest</span><span class="p">(</span><span class="n">path_or_kref</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetGroup</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Group</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_child_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Group</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get child groups of a parent group.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent group. If empty or &quot;/&quot;,</span>
<span class="sd">                         returns root-level groups.</span>
<span class="sd">            recursive: Whether to fetch all descendant groups recursively.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Group objects that are direct children of the parent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetChildGroupsRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetChildGroups</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Group</span><span class="p">(</span><span class="n">group_resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">group_resp</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">groups</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_group_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Group</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metadata for a group.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the group.</span>
<span class="sd">            metadata: The metadata to update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The updated Group object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UpdateMetadataRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateGroupMetadata</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Group</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Product methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">product_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Product</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new product.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent group.</span>
<span class="sd">            product_name: The name of the product.</span>
<span class="sd">            product_type: The type of the product (e.g., &quot;model&quot;, &quot;texture&quot;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Product object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ReservedProductTypeError: If product_type is reserved (e.g., &#39;collection&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.collection</span><span class="w"> </span><span class="kn">import</span> <span class="n">RESERVED_PRODUCT_TYPES</span><span class="p">,</span> <span class="n">ReservedProductTypeError</span>
        
        <span class="k">if</span> <span class="n">product_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">RESERVED_PRODUCT_TYPES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ReservedProductTypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Product type &#39;</span><span class="si">{</span><span class="n">product_type</span><span class="si">}</span><span class="s2">&#39; is reserved. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Use the dedicated create_collection() method instead.&quot;</span>
            <span class="p">)</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateProductRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="n">product_name</span><span class="p">,</span> <span class="n">product_type</span><span class="o">=</span><span class="n">product_type</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateProduct</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Product</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">product_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">product_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Product</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a product by its parent path, name, and type.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent group.</span>
<span class="sd">            product_name: The name of the product.</span>
<span class="sd">            product_type: The type of the product.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Product object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetProductRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="n">product_name</span><span class="p">,</span> <span class="n">product_type</span><span class="o">=</span><span class="n">product_type</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetProduct</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Product</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_product_by_kref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Product</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a product by its kref URI.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref_uri: The kref URI of the product.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Product object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kref</span> <span class="o">=</span> <span class="n">Kref</span><span class="p">(</span><span class="n">kref_uri</span><span class="p">)</span>
        <span class="n">product_path</span> <span class="o">=</span> <span class="n">kref</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>  <span class="c1"># e.g., &quot;projectA/modelA.asset&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">product_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid product kref format: </span><span class="si">{</span><span class="n">kref</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">group_path</span><span class="p">,</span> <span class="n">product_name_type</span> <span class="o">=</span> <span class="n">product_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">parent_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">group_path</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Add leading slash</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">product_name_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid product name.type format: </span><span class="si">{</span><span class="n">product_name_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">product_name</span><span class="p">,</span> <span class="n">product_type</span> <span class="o">=</span> <span class="n">product_name_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">product_name</span><span class="p">,</span> <span class="n">product_type</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_products</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">product_name_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">product_type_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Product</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get products within a group with optional filtering.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent group.</span>
<span class="sd">            product_name_filter: Optional filter for product names.</span>
<span class="sd">            product_type_filter: Optional filter for product types.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Product objects matching the filters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetProductsRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">product_name_filter</span><span class="o">=</span><span class="n">product_name_filter</span><span class="p">,</span> <span class="n">product_type_filter</span><span class="o">=</span><span class="n">product_type_filter</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetProducts</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">products</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">product_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">product_name_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">product_type_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Product</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for products across the system.</span>

<span class="sd">        Args:</span>
<span class="sd">            context_filter: Filter by context/path.</span>
<span class="sd">            product_name_filter: Filter by product name.</span>
<span class="sd">            product_type_filter: Filter by product type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Product objects matching the search criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">ProductSearchRequest</span><span class="p">(</span><span class="n">context_filter</span><span class="o">=</span><span class="n">context_filter</span><span class="p">,</span> <span class="n">product_name_filter</span><span class="o">=</span><span class="n">product_name_filter</span><span class="p">,</span> <span class="n">product_type_filter</span><span class="o">=</span><span class="n">product_type_filter</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ProductSearch</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Product</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">products</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_product_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Product</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metadata for a product.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the product.</span>
<span class="sd">            metadata: The metadata to update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The updated Product object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UpdateMetadataRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateProductMetadata</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Product</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Version</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new version for a product.</span>

<span class="sd">        Args:</span>
<span class="sd">            product_kref: The kref of the product.</span>
<span class="sd">            metadata: Optional metadata for the version.</span>
<span class="sd">            number: Specific version number to use (0 for auto-increment).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Version object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateVersionRequest</span><span class="p">(</span><span class="n">product_kref</span><span class="o">=</span><span class="n">product_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span> <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateVersion</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Version</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a version by its kref URI, with optional tag/time resolution.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref_uri: The kref URI of the version. Can include ?t=tag or ?time=timestamp</span>
<span class="sd">                     for tag/time resolution.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Version object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parse kref_uri for tag/time parameters</span>
        <span class="n">base_kref</span> <span class="o">=</span> <span class="n">kref_uri</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">kref_uri</span><span class="p">:</span>
            <span class="n">base_kref</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">kref_uri</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t=&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tag=&#39;</span><span class="p">):</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;time=&#39;</span><span class="p">):</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># Validate time format (YYYYMMDDHHMM)</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d</span><span class="si">{12}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;time must be in YYYYMMDDHHMM format&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use ResolveKref to find the specific version</span>
            <span class="c1"># We pass the base_kref (Product Kref) and the constraints</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">ResolveKrefRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">base_kref</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ResolveKref</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">()</span> <span class="o">==</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
                    <span class="c1"># Re-raise as NOT_FOUND</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span><span class="p">()</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">NOT_FOUND</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s2">&quot;Version not found&quot;</span>
                    <span class="k">raise</span> <span class="n">context</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">KrefRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kumiho_pb2</span><span class="o">.</span><span class="n">Kref</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">kref_uri</span><span class="p">))</span>
        
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetVersion</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_product_from_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_kref</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Product</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the product that contains a specific version.</span>

<span class="sd">        Args:</span>
<span class="sd">            version_kref: The kref URI of the version.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Product object that contains the version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First get the version to find its product relationship</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">(</span><span class="n">version_kref</span><span class="p">)</span>
        <span class="c1"># Parse the product_kref to extract parent_path, product_name, and product_type</span>
        <span class="n">product_path</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">product_kref</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>  <span class="c1"># e.g., &quot;group/product.type&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">product_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid product kref format: </span><span class="si">{</span><span class="n">version</span><span class="o">.</span><span class="n">product_kref</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">parent_path</span><span class="p">,</span> <span class="n">product_name_type</span> <span class="o">=</span> <span class="n">product_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">parent_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">parent_path</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Add leading slash</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">product_name_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid product name.type format: </span><span class="si">{</span><span class="n">product_name_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">product_name</span><span class="p">,</span> <span class="n">product_type</span> <span class="o">=</span> <span class="n">product_name_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_product</span><span class="p">(</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">product_name</span><span class="p">,</span> <span class="n">product_type</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_versions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Version</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all versions of a product.</span>

<span class="sd">        Args:</span>
<span class="sd">            product_kref: The kref of the product.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Version objects for the product.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetVersionsRequest</span><span class="p">(</span><span class="n">product_kref</span><span class="o">=</span><span class="n">product_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">())</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetVersions</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Version</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">versions</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_latest_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Version</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the latest version of a product.</span>

<span class="sd">        Args:</span>
<span class="sd">            product_kref: The kref of the product.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The latest Version object, or None if no versions exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">ResolveKrefRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">product_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ResolveKref</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">()</span> <span class="o">==</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a version.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the version to delete.</span>
<span class="sd">            force: Whether to force deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteVersionRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteVersion</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a group.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path of the group to delete.</span>
<span class="sd">            force: Whether to force deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteGroupRequest</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteGroup</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a product.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the product to delete.</span>
<span class="sd">            force: Whether to force deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteProductRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteProduct</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_version_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Version</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metadata for a version.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the version.</span>
<span class="sd">            metadata: The metadata to update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The updated Version object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UpdateMetadataRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateVersionMetadata</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Version</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">peek_next_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the next version number that would be assigned to a product.</span>

<span class="sd">        Args:</span>
<span class="sd">            product_kref: The kref of the product.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The next version number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">PeekNextVersionRequest</span><span class="p">(</span><span class="n">product_kref</span><span class="o">=</span><span class="n">product_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">())</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">PeekNextVersion</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">number</span>

    <span class="c1"># Tagging methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tag_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a tag to a version.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the version.</span>
<span class="sd">            tag: The tag to apply.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">TagVersionRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">TagVersion</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">untag_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a tag from a version.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the version.</span>
<span class="sd">            tag: The tag to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UnTagVersionRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UnTagVersion</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a version has a specific tag.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the version.</span>
<span class="sd">            tag: The tag to check for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the version has the tag, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">HasTagRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">HasTag</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">has_tag</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">was_tagged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a version was ever tagged with a specific tag.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the version.</span>
<span class="sd">            tag: The tag to check for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the version was ever tagged with the given tag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">WasTaggedRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">WasTagged</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">was_tagged</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_default_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the default resource for a version.</span>

<span class="sd">        Args:</span>
<span class="sd">            version_kref: The kref of the version.</span>
<span class="sd">            resource_name: The name of the resource to set as default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">SetDefaultResourceRequest</span><span class="p">(</span><span class="n">version_kref</span><span class="o">=</span><span class="n">version_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">resource_name</span><span class="o">=</span><span class="n">resource_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">SetDefaultResource</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="c1"># Resource methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Resource</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new resource for a version.</span>

<span class="sd">        Args:</span>
<span class="sd">            version_kref: The kref of the parent version.</span>
<span class="sd">            name: The name of the resource.</span>
<span class="sd">            location: The storage location of the resource.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Resource object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateResourceRequest</span><span class="p">(</span><span class="n">version_kref</span><span class="o">=</span><span class="n">version_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateResource</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Resource</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Resource</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a resource by version kref and name.</span>

<span class="sd">        Args:</span>
<span class="sd">            version_kref: The kref of the parent version.</span>
<span class="sd">            name: The name of the resource.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Resource object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetResourceRequest</span><span class="p">(</span><span class="n">version_kref</span><span class="o">=</span><span class="n">version_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetResource</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Resource</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_resource_by_kref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Resource</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a resource by its kref URI.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref_uri: The kref URI of the resource (e.g., &quot;kref://group/product.type?v=1&amp;r=resource_name&quot;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Resource object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the kref URI does not contain a resource name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kref</span> <span class="o">=</span> <span class="n">Kref</span><span class="p">(</span><span class="n">kref_uri</span><span class="p">)</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="n">kref</span><span class="o">.</span><span class="n">get_resource_name</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid resource kref format: </span><span class="si">{</span><span class="n">kref_uri</span><span class="si">}</span><span class="s2"> (missing &amp;r=resource_name)&quot;</span><span class="p">)</span>
        
        <span class="c1"># Build the version kref by removing the resource part</span>
        <span class="n">version_kref_uri</span> <span class="o">=</span> <span class="n">kref_uri</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;r=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">version_kref</span> <span class="o">=</span> <span class="n">Kref</span><span class="p">(</span><span class="n">version_kref_uri</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">version_kref</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Resource</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all resources for a version.</span>

<span class="sd">        Args:</span>
<span class="sd">            version_kref: The kref of the version.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Resource objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetResourcesRequest</span><span class="p">(</span><span class="n">version_kref</span><span class="o">=</span><span class="n">version_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">())</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetResources</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Resource</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">resources</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_resources_by_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Resource</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all resources at a specific location.</span>

<span class="sd">        Args:</span>
<span class="sd">            location: The location to search for resources.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Resource objects at the location.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetResourcesByLocationRequest</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetResourcesByLocation</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Resource</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">resources</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the resource to delete.</span>
<span class="sd">            force: Whether to force deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteResourceRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteResource</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the deprecated status of a node (Product, Version, Resource).</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the node.</span>
<span class="sd">            deprecated: True to deprecate, False to un-deprecate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">SetDeprecatedRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">deprecated</span><span class="o">=</span><span class="n">deprecated</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">SetDeprecated</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_resource_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Resource</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metadata for a resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the resource.</span>
<span class="sd">            metadata: The metadata to update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The updated Resource object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UpdateMetadataRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateResourceMetadata</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Resource</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_tenant_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current tenant&#39;s usage and limits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing node_count, node_limit, and tenant_id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetTenantUsageRequest</span><span class="p">()</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetTenantUsage</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MessageToDict</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">preserving_proto_field_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">always_print_fields_with_no_presence</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolves a Kref to a file location using the server-side ResolveLocation RPC.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            kref: The Kref URI to resolve. Can include query parameters like ?v=, ?t=, ?time=.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            The resolved file location string, or None if resolution fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Parse tag/time from kref if present to pass explicitly</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">if</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">kref</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">kref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t=&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tag=&#39;</span><span class="p">):</span>
                        <span class="n">tag</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;time=&#39;</span><span class="p">):</span>
                        <span class="n">time</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">req</span> <span class="o">=</span> <span class="n">ResolveLocationRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ResolveLocation</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">location</span>
        <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Attribute methods (granular metadata operations)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a single metadata attribute on any entity.</span>

<span class="sd">        This allows granular updates to metadata without replacing the entire</span>
<span class="sd">        metadata map. The attribute key cannot be a reserved system field.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the entity (Version, Product, Resource, or Group).</span>
<span class="sd">            key: The attribute key to set.</span>
<span class="sd">            value: The attribute value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the attribute was set successfully.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the entity is not found or the key is reserved.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client.set_attribute(version.kref, &quot;render_engine&quot;, &quot;cycles&quot;)</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">SetAttributeRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">success</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a single metadata attribute from any entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the entity (Version, Product, Resource, or Group).</span>
<span class="sd">            key: The attribute key to retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The attribute value if it exists, None otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the entity is not found.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client.get_attribute(version.kref, &quot;render_engine&quot;)</span>
<span class="sd">            &quot;cycles&quot;</span>
<span class="sd">            &gt;&gt;&gt; client.get_attribute(version.kref, &quot;nonexistent&quot;)</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetAttributeRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">exists</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a single metadata attribute from any entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the entity (Version, Product, Resource, or Group).</span>
<span class="sd">            key: The attribute key to delete.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the attribute was deleted successfully.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the entity is not found or the key is reserved.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client.delete_attribute(version.kref, &quot;deprecated_field&quot;)</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteAttributeRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteAttribute</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">success</span>

    <span class="c1"># Link methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_link</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_version</span><span class="p">:</span> <span class="n">Version</span><span class="p">,</span>
        <span class="n">target_version</span><span class="p">:</span> <span class="n">Version</span><span class="p">,</span>
        <span class="n">link_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Link</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a link between two versions.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_version: The source version of the link.</span>
<span class="sd">            target_version: The target version of the link.</span>
<span class="sd">            link_type: The type of relationship (e.g., kumiho.LinkType.DEPENDS_ON).</span>
<span class="sd">                       See kumiho.LinkType for standard types.</span>
<span class="sd">                       Must be UPPERCASE with letters, digits, underscores only.</span>
<span class="sd">            metadata: Optional metadata for the link.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Link object.</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            LinkTypeValidationError: If link_type is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.link</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_link_type</span>
        <span class="n">validate_link_type</span><span class="p">(</span><span class="n">link_type</span><span class="p">)</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateLinkRequest</span><span class="p">(</span>
            <span class="n">source_version_kref</span><span class="o">=</span><span class="n">source_version</span><span class="o">.</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">target_version_kref</span><span class="o">=</span><span class="n">target_version</span><span class="o">.</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">link_type</span><span class="o">=</span><span class="n">link_type</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateLink</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="c1"># Construct Link object client-side since RPC returns only status</span>
        <span class="n">pb_link</span> <span class="o">=</span> <span class="n">PbLink</span><span class="p">(</span>
            <span class="n">source_kref</span><span class="o">=</span><span class="n">source_version</span><span class="o">.</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">target_kref</span><span class="o">=</span><span class="n">target_version</span><span class="o">.</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">link_type</span><span class="o">=</span><span class="n">link_type</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Link</span><span class="p">(</span><span class="n">pb_link</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">link_type_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Link</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get links associated with a kref.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref to get links for.</span>
<span class="sd">            link_type_filter: Optional filter for link types.</span>
<span class="sd">            direction: The direction of links to retrieve (0=OUTGOING, 1=INCOMING, 2=BOTH).</span>
<span class="sd">                       See kumiho.LinkDirection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Link objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetLinksRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">link_type_filter</span><span class="o">=</span><span class="n">link_type_filter</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetLinks</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Link</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">pb</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">links</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">target_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">link_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a link between versions.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_kref: The source version kref.</span>
<span class="sd">            target_kref: The target version kref.</span>
<span class="sd">            link_type: The type of link to delete.</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            LinkTypeValidationError: If link_type is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.link</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_link_type</span>
        <span class="n">validate_link_type</span><span class="p">(</span><span class="n">link_type</span><span class="p">)</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteLinkRequest</span><span class="p">(</span>
            <span class="n">source_kref</span><span class="o">=</span><span class="n">source_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">target_kref</span><span class="o">=</span><span class="n">target_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">link_type</span><span class="o">=</span><span class="n">link_type</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteLink</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="c1"># Graph Traversal Methods</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">traverse_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">origin_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">link_type_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">include_path</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;TraversalResult&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Traverse links transitively from an origin version.</span>

<span class="sd">        Args:</span>
<span class="sd">            origin_kref: The starting version kref.</span>
<span class="sd">            direction: Traversal direction (0=OUTGOING, 1=INCOMING, 2=BOTH).</span>
<span class="sd">            link_type_filter: Filter by link types (empty = all).</span>
<span class="sd">            max_depth: Maximum traversal depth (default: 10, max: 20).</span>
<span class="sd">            limit: Maximum results to return (default: 100, max: 1000).</span>
<span class="sd">            include_path: Whether to include full path information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TraversalResult containing discovered versions and paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.link</span><span class="w"> </span><span class="kn">import</span> <span class="n">TraversalResult</span><span class="p">,</span> <span class="n">VersionPath</span><span class="p">,</span> <span class="n">PathStep</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">TraverseLinksRequest</span><span class="p">(</span>
            <span class="n">origin_kref</span><span class="o">=</span><span class="n">origin_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
            <span class="n">link_type_filter</span><span class="o">=</span><span class="n">link_type_filter</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">include_path</span><span class="o">=</span><span class="n">include_path</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">TraverseLinks</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="n">version_krefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Kref</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">version_krefs</span><span class="p">]</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">PathStep</span><span class="p">(</span>
                <span class="n">version_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">version_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">),</span>
                <span class="n">link_type</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">link_type</span><span class="p">,</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">depth</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">steps</span><span class="p">]</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">VersionPath</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span> <span class="n">total_depth</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">total_depth</span><span class="p">))</span>
        
        <span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">Link</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">pb</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">links</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">TraversalResult</span><span class="p">(</span>
            <span class="n">version_krefs</span><span class="o">=</span><span class="n">version_krefs</span><span class="p">,</span>
            <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
            <span class="n">links</span><span class="o">=</span><span class="n">links</span><span class="p">,</span>
            <span class="n">total_count</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">total_count</span><span class="p">,</span>
            <span class="n">truncated</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">truncated</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="bp">self</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_shortest_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">target_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">link_type_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">all_shortest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ShortestPathResult&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the shortest path between two versions.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_kref: The source version kref.</span>
<span class="sd">            target_kref: The target version kref.</span>
<span class="sd">            link_type_filter: Filter by link types (empty = all).</span>
<span class="sd">            max_depth: Maximum path length to search (default: 10).</span>
<span class="sd">            all_shortest: Return all shortest paths, not just one.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ShortestPathResult containing path(s) if found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.link</span><span class="w"> </span><span class="kn">import</span> <span class="n">VersionPath</span><span class="p">,</span> <span class="n">PathStep</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">ShortestPathRequest</span><span class="p">(</span>
            <span class="n">source_kref</span><span class="o">=</span><span class="n">source_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">target_kref</span><span class="o">=</span><span class="n">target_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">link_type_filter</span><span class="o">=</span><span class="n">link_type_filter</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
            <span class="n">all_shortest</span><span class="o">=</span><span class="n">all_shortest</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">FindShortestPath</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">PathStep</span><span class="p">(</span>
                <span class="n">version_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">version_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">),</span>
                <span class="n">link_type</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">link_type</span><span class="p">,</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">depth</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">steps</span><span class="p">]</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">VersionPath</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span> <span class="n">total_depth</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">total_depth</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">ShortestPathResult</span><span class="p">(</span>
            <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
            <span class="n">path_exists</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">path_exists</span><span class="p">,</span>
            <span class="n">path_length</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">path_length</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_impact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">version_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">link_type_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s1">&#39;ImpactedVersion&#39;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze what would be impacted by changes to a version.</span>

<span class="sd">        Finds all versions that directly or indirectly depend on the</span>
<span class="sd">        given version.</span>

<span class="sd">        Args:</span>
<span class="sd">            version_kref: The version to analyze impact for.</span>
<span class="sd">            link_type_filter: Filter by link types (default: DEPENDS_ON).</span>
<span class="sd">            max_depth: Maximum traversal depth (default: 10).</span>
<span class="sd">            limit: Maximum results (default: 100).</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of ImpactedVersion objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.link</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpactedVersion</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">ImpactAnalysisRequest</span><span class="p">(</span>
            <span class="n">version_kref</span><span class="o">=</span><span class="n">version_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">link_type_filter</span><span class="o">=</span><span class="n">link_type_filter</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">AnalyzeImpact</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">ImpactedVersion</span><span class="p">(</span>
                <span class="n">version_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">iv</span><span class="o">.</span><span class="n">version_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">),</span>
                <span class="n">product_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">iv</span><span class="o">.</span><span class="n">product_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span> <span class="k">if</span> <span class="n">iv</span><span class="o">.</span><span class="n">product_kref</span><span class="o">.</span><span class="n">uri</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">impact_depth</span><span class="o">=</span><span class="n">iv</span><span class="o">.</span><span class="n">impact_depth</span><span class="p">,</span>
                <span class="n">impact_path_types</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">iv</span><span class="o">.</span><span class="n">impact_path_types</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">iv</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">impacted_versions</span>
        <span class="p">]</span>

    <span class="c1"># Collection Methods</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_collection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Collection&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new collection product.</span>

<span class="sd">        Collections are special products that aggregate other products.</span>
<span class="sd">        The ``collection`` product_type is reserved and can only be created</span>
<span class="sd">        through this method (not via :meth:`create_product`).</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.project.Project.create_collection` or</span>
<span class="sd">            :meth:`~kumiho.group.Group.create_collection` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path to the parent group (e.g., ``/project/group``).</span>
<span class="sd">            collection_name: The name of the collection. Must be unique within</span>
<span class="sd">                the parent group.</span>
<span class="sd">            metadata: Optional key-value metadata for the collection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Collection: The created Collection object with ``product_type=&#39;collection&#39;``.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the collection name is already taken or connection fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.collection</span><span class="w"> </span><span class="kn">import</span> <span class="n">Collection</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateCollectionRequest</span><span class="p">(</span>
            <span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateCollection</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Collection</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_collection_member</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">member_product_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Version</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a product to a collection.</span>

<span class="sd">        Creates a new version of the collection to track the change with</span>
<span class="sd">        full audit trail.</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.collection.Collection.add_member` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection_kref: The kref pointing to the collection product.</span>
<span class="sd">            member_product_kref: The kref pointing to the product to add.</span>
<span class="sd">            metadata: Optional key-value metadata to store in the version.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[bool, str, Optional[Version]]: A tuple containing:</span>
<span class="sd">                - success: Whether the operation succeeded.</span>
<span class="sd">                - message: Status message (e.g., &quot;Added&quot; or error details).</span>
<span class="sd">                - new_version: The new collection version, or None on failure.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the collection or member product is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">AddCollectionMemberRequest</span><span class="p">(</span>
            <span class="n">collection_kref</span><span class="o">=</span><span class="n">collection_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">member_product_kref</span><span class="o">=</span><span class="n">member_product_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">AddCollectionMember</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">new_version</span> <span class="o">=</span> <span class="n">Version</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">new_version</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">new_version</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">new_version</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_collection_member</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">member_product_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Version</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a product from a collection.</span>

<span class="sd">        Creates a new version of the collection to track the change with</span>
<span class="sd">        full audit trail.</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.collection.Collection.remove_member` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection_kref: The kref pointing to the collection product.</span>
<span class="sd">            member_product_kref: The kref pointing to the product to remove.</span>
<span class="sd">            metadata: Optional key-value metadata to store in the version.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[bool, str, Optional[Version]]: A tuple containing:</span>
<span class="sd">                - success: Whether the operation succeeded.</span>
<span class="sd">                - message: Status message (e.g., &quot;Removed&quot; or error details).</span>
<span class="sd">                - new_version: The new collection version, or None on failure.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the collection or member product is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">RemoveCollectionMemberRequest</span><span class="p">(</span>
            <span class="n">collection_kref</span><span class="o">=</span><span class="n">collection_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">member_product_kref</span><span class="o">=</span><span class="n">member_product_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">RemoveCollectionMember</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">new_version</span> <span class="o">=</span> <span class="n">Version</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">new_version</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">new_version</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">new_version</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_members</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">version_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s1">&#39;CollectionMember&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all members of a collection.</span>

<span class="sd">        Retrieves the list of products that belong to a collection at</span>
<span class="sd">        a specific version (or the latest version if not specified).</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.collection.Collection.get_members` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection_kref: The kref pointing to the collection product.</span>
<span class="sd">            version_number: Optional specific version to query. If not provided,</span>
<span class="sd">                returns members from the latest version.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[CollectionMember], int, int]: A tuple containing:</span>
<span class="sd">                - members: List of :class:`~kumiho.collection.CollectionMember` objects.</span>
<span class="sd">                - version_number: The version number queried.</span>
<span class="sd">                - total_count: Total number of members.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the collection is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.collection</span><span class="w"> </span><span class="kn">import</span> <span class="n">CollectionMember</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetCollectionMembersRequest</span><span class="p">(</span>
            <span class="n">collection_kref</span><span class="o">=</span><span class="n">collection_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">version_number</span><span class="o">=</span><span class="n">version_number</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetCollectionMembers</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="n">members</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">CollectionMember</span><span class="p">(</span>
                <span class="n">product_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">product_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">),</span>
                <span class="n">added_at</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">added_at</span><span class="p">,</span>
                <span class="n">added_by</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">added_by</span><span class="p">,</span>
                <span class="n">added_by_username</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">added_by_username</span><span class="p">,</span>
                <span class="n">added_in_version</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">added_in_version</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">members</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">members</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">version_number</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">total_count</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_history</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">collection_kref</span><span class="p">:</span> <span class="n">Kref</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s1">&#39;CollectionVersionHistory&#39;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the history of changes to a collection&#39;s membership.</span>

<span class="sd">        Returns a chronological list of membership changes (adds/removes)</span>
<span class="sd">        with full audit trail including author information and timestamps.</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.collection.Collection.get_history` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection_kref: The kref pointing to the collection product.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[CollectionVersionHistory]: List of</span>
<span class="sd">                :class:`~kumiho.collection.CollectionVersionHistory` objects</span>
<span class="sd">                documenting each membership change.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the collection is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.collection</span><span class="w"> </span><span class="kn">import</span> <span class="n">CollectionVersionHistory</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetCollectionHistoryRequest</span><span class="p">(</span>
            <span class="n">collection_kref</span><span class="o">=</span><span class="n">collection_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetCollectionHistory</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">CollectionVersionHistory</span><span class="p">(</span>
                <span class="n">version_number</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">version_number</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
                <span class="n">member_product_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">member_product_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span> <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">member_product_kref</span><span class="o">.</span><span class="n">uri</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">author</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                <span class="n">created_at</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">history</span>
        <span class="p">]</span>

    <span class="c1"># Event Streaming</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">event_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">routing_key_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kref_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Event</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subscribe to the event stream from the Kumiho server.</span>

<span class="sd">        Args:</span>
<span class="sd">            routing_key_filter: A filter for the events to receive.</span>
<span class="sd">                                Supports wildcards, e.g., &quot;product.model.*&quot;</span>
<span class="sd">            kref_filter: A filter for the kref URIs to receive events for.</span>
<span class="sd">                        Supports wildcards, e.g., &quot;kref://projectA/**/*.model&quot;</span>

<span class="sd">        Yields:</span>
<span class="sd">            Event objects representing changes in the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">EventStreamRequest</span><span class="p">(</span><span class="n">routing_key_filter</span><span class="o">=</span><span class="n">routing_key_filter</span><span class="p">,</span> <span class="n">kref_filter</span><span class="o">=</span><span class="n">kref_filter</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pb_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">EventStream</span><span class="p">(</span><span class="n">req</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Event</span><span class="p">(</span><span class="n">pb_event</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_ClientCallDetails</span><span class="p">(</span><span class="n">grpc</span><span class="o">.</span><span class="n">ClientCallDetails</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mutable wrapper that lets us override metadata on outbound RPCs.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">grpc</span><span class="o">.</span><span class="n">CallCredentials</span><span class="p">],</span>
        <span class="n">wait_for_ready</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
        <span class="n">compression</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">grpc</span><span class="o">.</span><span class="n">Compression</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">tuple</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">)</span> <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_ready</span> <span class="o">=</span> <span class="n">wait_for_ready</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_augment_call_details</span><span class="p">(</span>
    <span class="n">client_call_details</span><span class="p">:</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ClientCallDetails</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ClientCallDetails</span><span class="p">:</span>
    <span class="n">existing</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">[]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">existing</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">existing</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">existing</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
    <span class="n">existing</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_ClientCallDetails</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">existing</span><span class="p">,</span>
        <span class="n">credentials</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">credentials</span><span class="p">,</span>
        <span class="n">wait_for_ready</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="s2">&quot;wait_for_ready&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">compression</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_MetadataInjector</span><span class="p">(</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryUnaryClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryStreamClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">StreamUnaryClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">StreamStreamClientInterceptor</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Client interceptor that injects static metadata such as auth tokens.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Injecting metadata: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">_augment_call_details</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">_augment_call_details</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_stream_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">_augment_call_details</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_stream_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">_augment_call_details</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_AutoLoginInterceptor</span><span class="p">(</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryUnaryClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryStreamClientInterceptor</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Client interceptor that automatically prompts for login on auth failures.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">continuation</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        
        <span class="c1"># Check if this is an auth error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Force the response to be evaluated</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">):</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">UNAUTHENTICATED</span><span class="p">,</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">PERMISSION_DENIED</span><span class="p">):</span>
                    <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Authentication error detected, prompting for login...&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">auth_cli</span>
                        <span class="n">new_token</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">auth_cli</span><span class="o">.</span><span class="n">ensure_token</span><span class="p">(</span><span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        
                        <span class="c1"># Update the authorization header with the new token</span>
                        <span class="n">existing_metadata</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">[]):</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                                <span class="n">existing_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                                <span class="n">existing_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># memoryview or other buffer-like object</span>
                                <span class="n">existing_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
                        <span class="c1"># Remove old authorization header</span>
                        <span class="n">existing_metadata</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">existing_metadata</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;authorization&quot;</span><span class="p">]</span>
                        <span class="c1"># Add new token</span>
                        <span class="n">existing_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;authorization&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">new_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
                        
                        <span class="n">updated_details</span> <span class="o">=</span> <span class="n">_ClientCallDetails</span><span class="p">(</span>
                            <span class="n">method</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
                            <span class="n">timeout</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
                            <span class="n">metadata</span><span class="o">=</span><span class="n">existing_metadata</span><span class="p">,</span>
                            <span class="n">credentials</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">credentials</span><span class="p">,</span>
                            <span class="n">wait_for_ready</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="s2">&quot;wait_for_ready&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                            <span class="n">compression</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="p">)</span>
                        
                        <span class="c1"># Retry the RPC with the new token</span>
                        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Retrying RPC with new credentials...&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated_details</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Auto-login failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">response</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># If we can&#39;t check the error, just return the original response</span>
            <span class="k">pass</span>
        
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># For streaming responses, we can&#39;t easily retry, so just pass through</span>
        <span class="c1"># The first error will be caught and user will be prompted to re-run</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Kumiho Clouds.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>