

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>kumiho.client &mdash; Kumiho Python SDK v0.8.6</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=279f42e0"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Kumiho Python SDK
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#authentication">Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#using-the-cli">Using the CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#programmatic-authentication">Programmatic Authentication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#basic-concepts">Basic Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#projects">Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#spaces">Spaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#items">Items</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#revisions">Revisions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#artifacts">Artifacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#edges">Edges</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#bundles">Bundles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#kref-uris">Kref URIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#error-handling">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#ai-assistant-integration-mcp">AI Assistant Integration (MCP)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started.html#quick-setup">Quick Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Core Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#graph-native-architecture">Graph-Native Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#entity-hierarchy">Entity Hierarchy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#project">Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#space">Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#item">Item</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#revision">Revision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#artifact">Artifact</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#edge">Edge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#graph-traversal">Graph Traversal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#bundle">Bundle</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#metadata">Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#setting-metadata">Setting Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#granular-attribute-operations">Granular Attribute Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#common-metadata-patterns">Common Metadata Patterns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#kref-uri-scheme">Kref URI Scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#time-based-revision-queries">Time-Based Revision Queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#why-time-based-queries-matter">Why Time-Based Queries Matter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#using-get-revision-by-time">Using <code class="docutils literal notranslate"><span class="pre">get_revision_by_time</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#time-based-kref-uris">Time-Based Kref URIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#practical-examples">Practical Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#tags-and-time">Tags and Time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#byo-storage-philosophy">BYO Storage Philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#multi-tenant-architecture">Multi-Tenant Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#event-streaming">Event Streaming</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#event-object">Event Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#event-types-routing-keys">Event Types (Routing Keys)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#tier-based-capabilities">Tier-Based Capabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#query-tier-capabilities">Query Tier Capabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#resumable-streaming-coming-soon-creator">Resumable Streaming (Coming Soon - Creator+)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#replay-from-beginning-coming-soon-creator">Replay from Beginning (Coming Soon - Creator+)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#feature-gated-streaming">Feature-Gated Streaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../concepts.html#use-cases-by-tier">Use Cases by Tier</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../authentication.html">Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#cli-authentication">CLI Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#cached-credentials">Cached Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#refreshing-tokens">Refreshing Tokens</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#programmatic-authentication">Programmatic Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#with-firebase-id-token">With Firebase ID Token</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#with-environment-variables">With Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#future-authentication-methods">Future Authentication Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#discovery-flow">Discovery Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#discovery-response">Discovery Response</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#token-refresh">Token Refresh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#multiple-tenants">Multiple Tenants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#security-best-practices">Security Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#token-expired">Token Expired</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#invalid-tenant">Invalid Tenant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../authentication.html#connection-failed">Connection Failed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../authentication.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../mcp.html">MCP Server Integration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#what-is-mcp">What is MCP?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#authentication">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#running-the-mcp-server">Running the MCP Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#standalone-mode">Standalone Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#vs-code-github-copilot-integration">VS Code / GitHub Copilot Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#claude-desktop-integration">Claude Desktop Integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#available-tools">Available Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#read-operations-14-tools">Read Operations (14 tools)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#graph-traversal-5-tools">Graph Traversal (5 tools)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#create-operations-8-tools">Create Operations (8 tools)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#delete-operations-6-tools">Delete Operations (6 tools)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#update-operations-6-tools">Update Operations (6 tools)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#example-conversations">Example Conversations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#exploring-assets">Exploring Assets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#dependency-analysis">Dependency Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#asset-management">Asset Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#ai-lineage-tracking">AI Lineage Tracking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#kref-uri-format">Kref URI Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#edge-types">Edge Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#mcp-resources-and-prompts">MCP Resources and Prompts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#resources">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#prompts">Prompts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#server-won-t-start">Server wonâ€™t start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#tools-not-appearing-in-ai-assistant">Tools not appearing in AI assistant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mcp.html#authentication-errors">Authentication errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../mcp.html#api-reference">API Reference</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/kumiho.html">kumiho</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.__version__"><code class="docutils literal notranslate"><span class="pre">__version__</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.LATEST_TAG"><code class="docutils literal notranslate"><span class="pre">LATEST_TAG</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.PUBLISHED_TAG"><code class="docutils literal notranslate"><span class="pre">PUBLISHED_TAG</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.KumihoObject"><code class="docutils literal notranslate"><span class="pre">KumihoObject</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.KumihoObject._client"><code class="docutils literal notranslate"><span class="pre">KumihoObject._client</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.KumihoObject.__init__"><code class="docutils literal notranslate"><span class="pre">KumihoObject.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.KumihoError"><code class="docutils literal notranslate"><span class="pre">KumihoError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project"><code class="docutils literal notranslate"><span class="pre">Project</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.project_id"><code class="docutils literal notranslate"><span class="pre">Project.project_id</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.name"><code class="docutils literal notranslate"><span class="pre">Project.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.description"><code class="docutils literal notranslate"><span class="pre">Project.description</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.created_at"><code class="docutils literal notranslate"><span class="pre">Project.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.updated_at"><code class="docutils literal notranslate"><span class="pre">Project.updated_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.deprecated"><code class="docutils literal notranslate"><span class="pre">Project.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.allow_public"><code class="docutils literal notranslate"><span class="pre">Project.allow_public</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.__init__"><code class="docutils literal notranslate"><span class="pre">Project.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.__repr__"><code class="docutils literal notranslate"><span class="pre">Project.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.create_bundle"><code class="docutils literal notranslate"><span class="pre">Project.create_bundle()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.create_item"><code class="docutils literal notranslate"><span class="pre">Project.create_item()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.create_space"><code class="docutils literal notranslate"><span class="pre">Project.create_space()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.delete"><code class="docutils literal notranslate"><span class="pre">Project.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.get_bundle"><code class="docutils literal notranslate"><span class="pre">Project.get_bundle()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.get_item"><code class="docutils literal notranslate"><span class="pre">Project.get_item()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.get_items"><code class="docutils literal notranslate"><span class="pre">Project.get_items()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.get_space"><code class="docutils literal notranslate"><span class="pre">Project.get_space()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.get_spaces"><code class="docutils literal notranslate"><span class="pre">Project.get_spaces()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.set_allow_public"><code class="docutils literal notranslate"><span class="pre">Project.set_allow_public()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.set_public"><code class="docutils literal notranslate"><span class="pre">Project.set_public()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Project.update"><code class="docutils literal notranslate"><span class="pre">Project.update()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space"><code class="docutils literal notranslate"><span class="pre">Space</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.path"><code class="docutils literal notranslate"><span class="pre">Space.path</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.name"><code class="docutils literal notranslate"><span class="pre">Space.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.type"><code class="docutils literal notranslate"><span class="pre">Space.type</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.created_at"><code class="docutils literal notranslate"><span class="pre">Space.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.author"><code class="docutils literal notranslate"><span class="pre">Space.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.metadata"><code class="docutils literal notranslate"><span class="pre">Space.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.username"><code class="docutils literal notranslate"><span class="pre">Space.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.__init__"><code class="docutils literal notranslate"><span class="pre">Space.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.__repr__"><code class="docutils literal notranslate"><span class="pre">Space.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.create_bundle"><code class="docutils literal notranslate"><span class="pre">Space.create_bundle()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.create_item"><code class="docutils literal notranslate"><span class="pre">Space.create_item()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.create_space"><code class="docutils literal notranslate"><span class="pre">Space.create_space()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.delete"><code class="docutils literal notranslate"><span class="pre">Space.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.delete_attribute"><code class="docutils literal notranslate"><span class="pre">Space.delete_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.get_attribute"><code class="docutils literal notranslate"><span class="pre">Space.get_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.get_bundle"><code class="docutils literal notranslate"><span class="pre">Space.get_bundle()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.get_child_spaces"><code class="docutils literal notranslate"><span class="pre">Space.get_child_spaces()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.get_item"><code class="docutils literal notranslate"><span class="pre">Space.get_item()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.get_items"><code class="docutils literal notranslate"><span class="pre">Space.get_items()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.get_parent_space"><code class="docutils literal notranslate"><span class="pre">Space.get_parent_space()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.get_project"><code class="docutils literal notranslate"><span class="pre">Space.get_project()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.get_space"><code class="docutils literal notranslate"><span class="pre">Space.get_space()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.get_spaces"><code class="docutils literal notranslate"><span class="pre">Space.get_spaces()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.set_attribute"><code class="docutils literal notranslate"><span class="pre">Space.set_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Space.set_metadata"><code class="docutils literal notranslate"><span class="pre">Space.set_metadata()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item"><code class="docutils literal notranslate"><span class="pre">Item</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.kref"><code class="docutils literal notranslate"><span class="pre">Item.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.name"><code class="docutils literal notranslate"><span class="pre">Item.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.item_name"><code class="docutils literal notranslate"><span class="pre">Item.item_name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.kind"><code class="docutils literal notranslate"><span class="pre">Item.kind</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.project"><code class="docutils literal notranslate"><span class="pre">Item.project</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.space"><code class="docutils literal notranslate"><span class="pre">Item.space</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.created_at"><code class="docutils literal notranslate"><span class="pre">Item.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.author"><code class="docutils literal notranslate"><span class="pre">Item.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.metadata"><code class="docutils literal notranslate"><span class="pre">Item.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.deprecated"><code class="docutils literal notranslate"><span class="pre">Item.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.username"><code class="docutils literal notranslate"><span class="pre">Item.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.__init__"><code class="docutils literal notranslate"><span class="pre">Item.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.__repr__"><code class="docutils literal notranslate"><span class="pre">Item.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.create_revision"><code class="docutils literal notranslate"><span class="pre">Item.create_revision()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.delete"><code class="docutils literal notranslate"><span class="pre">Item.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.delete_attribute"><code class="docutils literal notranslate"><span class="pre">Item.delete_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.get_attribute"><code class="docutils literal notranslate"><span class="pre">Item.get_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.get_latest_revision"><code class="docutils literal notranslate"><span class="pre">Item.get_latest_revision()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.get_project"><code class="docutils literal notranslate"><span class="pre">Item.get_project()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.get_revision"><code class="docutils literal notranslate"><span class="pre">Item.get_revision()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.get_revision_by_tag"><code class="docutils literal notranslate"><span class="pre">Item.get_revision_by_tag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.get_revision_by_time"><code class="docutils literal notranslate"><span class="pre">Item.get_revision_by_time()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.get_revisions"><code class="docutils literal notranslate"><span class="pre">Item.get_revisions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.get_space"><code class="docutils literal notranslate"><span class="pre">Item.get_space()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.peek_next_revision"><code class="docutils literal notranslate"><span class="pre">Item.peek_next_revision()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id0"><code class="docutils literal notranslate"><span class="pre">Item.project</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.set_attribute"><code class="docutils literal notranslate"><span class="pre">Item.set_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.set_deprecated"><code class="docutils literal notranslate"><span class="pre">Item.set_deprecated()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Item.set_metadata"><code class="docutils literal notranslate"><span class="pre">Item.set_metadata()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id1"><code class="docutils literal notranslate"><span class="pre">Item.space</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision"><code class="docutils literal notranslate"><span class="pre">Revision</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.kref"><code class="docutils literal notranslate"><span class="pre">Revision.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.item_kref"><code class="docutils literal notranslate"><span class="pre">Revision.item_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.number"><code class="docutils literal notranslate"><span class="pre">Revision.number</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.latest"><code class="docutils literal notranslate"><span class="pre">Revision.latest</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.tags"><code class="docutils literal notranslate"><span class="pre">Revision.tags</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.metadata"><code class="docutils literal notranslate"><span class="pre">Revision.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.created_at"><code class="docutils literal notranslate"><span class="pre">Revision.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.author"><code class="docutils literal notranslate"><span class="pre">Revision.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.deprecated"><code class="docutils literal notranslate"><span class="pre">Revision.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.published"><code class="docutils literal notranslate"><span class="pre">Revision.published</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.username"><code class="docutils literal notranslate"><span class="pre">Revision.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.default_artifact"><code class="docutils literal notranslate"><span class="pre">Revision.default_artifact</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.__init__"><code class="docutils literal notranslate"><span class="pre">Revision.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.__repr__"><code class="docutils literal notranslate"><span class="pre">Revision.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.analyze_impact"><code class="docutils literal notranslate"><span class="pre">Revision.analyze_impact()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.create_artifact"><code class="docutils literal notranslate"><span class="pre">Revision.create_artifact()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.create_edge"><code class="docutils literal notranslate"><span class="pre">Revision.create_edge()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.delete"><code class="docutils literal notranslate"><span class="pre">Revision.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.delete_attribute"><code class="docutils literal notranslate"><span class="pre">Revision.delete_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.delete_edge"><code class="docutils literal notranslate"><span class="pre">Revision.delete_edge()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.find_path_to"><code class="docutils literal notranslate"><span class="pre">Revision.find_path_to()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_all_dependencies"><code class="docutils literal notranslate"><span class="pre">Revision.get_all_dependencies()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_all_dependents"><code class="docutils literal notranslate"><span class="pre">Revision.get_all_dependents()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_artifact"><code class="docutils literal notranslate"><span class="pre">Revision.get_artifact()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_artifacts"><code class="docutils literal notranslate"><span class="pre">Revision.get_artifacts()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_attribute"><code class="docutils literal notranslate"><span class="pre">Revision.get_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_edges"><code class="docutils literal notranslate"><span class="pre">Revision.get_edges()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_item"><code class="docutils literal notranslate"><span class="pre">Revision.get_item()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_locations"><code class="docutils literal notranslate"><span class="pre">Revision.get_locations()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_project"><code class="docutils literal notranslate"><span class="pre">Revision.get_project()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.get_space"><code class="docutils literal notranslate"><span class="pre">Revision.get_space()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.has_tag"><code class="docutils literal notranslate"><span class="pre">Revision.has_tag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.refresh"><code class="docutils literal notranslate"><span class="pre">Revision.refresh()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.set_attribute"><code class="docutils literal notranslate"><span class="pre">Revision.set_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.set_default_artifact"><code class="docutils literal notranslate"><span class="pre">Revision.set_default_artifact()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.set_deprecated"><code class="docutils literal notranslate"><span class="pre">Revision.set_deprecated()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.set_metadata"><code class="docutils literal notranslate"><span class="pre">Revision.set_metadata()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.tag"><code class="docutils literal notranslate"><span class="pre">Revision.tag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id2"><code class="docutils literal notranslate"><span class="pre">Revision.tags</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.untag"><code class="docutils literal notranslate"><span class="pre">Revision.untag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Revision.was_tagged"><code class="docutils literal notranslate"><span class="pre">Revision.was_tagged()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact"><code class="docutils literal notranslate"><span class="pre">Artifact</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.kref"><code class="docutils literal notranslate"><span class="pre">Artifact.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.location"><code class="docutils literal notranslate"><span class="pre">Artifact.location</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.revision_kref"><code class="docutils literal notranslate"><span class="pre">Artifact.revision_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.item_kref"><code class="docutils literal notranslate"><span class="pre">Artifact.item_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.created_at"><code class="docutils literal notranslate"><span class="pre">Artifact.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.author"><code class="docutils literal notranslate"><span class="pre">Artifact.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.metadata"><code class="docutils literal notranslate"><span class="pre">Artifact.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.deprecated"><code class="docutils literal notranslate"><span class="pre">Artifact.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.username"><code class="docutils literal notranslate"><span class="pre">Artifact.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.__init__"><code class="docutils literal notranslate"><span class="pre">Artifact.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.__repr__"><code class="docutils literal notranslate"><span class="pre">Artifact.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.delete"><code class="docutils literal notranslate"><span class="pre">Artifact.delete()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.delete_attribute"><code class="docutils literal notranslate"><span class="pre">Artifact.delete_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.get_attribute"><code class="docutils literal notranslate"><span class="pre">Artifact.get_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.get_item"><code class="docutils literal notranslate"><span class="pre">Artifact.get_item()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.get_project"><code class="docutils literal notranslate"><span class="pre">Artifact.get_project()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.get_revision"><code class="docutils literal notranslate"><span class="pre">Artifact.get_revision()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.get_space"><code class="docutils literal notranslate"><span class="pre">Artifact.get_space()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.name"><code class="docutils literal notranslate"><span class="pre">Artifact.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.set_attribute"><code class="docutils literal notranslate"><span class="pre">Artifact.set_attribute()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.set_default"><code class="docutils literal notranslate"><span class="pre">Artifact.set_default()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.set_deprecated"><code class="docutils literal notranslate"><span class="pre">Artifact.set_deprecated()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Artifact.set_metadata"><code class="docutils literal notranslate"><span class="pre">Artifact.set_metadata()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge"><code class="docutils literal notranslate"><span class="pre">Edge</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.source_kref"><code class="docutils literal notranslate"><span class="pre">Edge.source_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.target_kref"><code class="docutils literal notranslate"><span class="pre">Edge.target_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.edge_type"><code class="docutils literal notranslate"><span class="pre">Edge.edge_type</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.metadata"><code class="docutils literal notranslate"><span class="pre">Edge.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.created_at"><code class="docutils literal notranslate"><span class="pre">Edge.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.author"><code class="docutils literal notranslate"><span class="pre">Edge.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.username"><code class="docutils literal notranslate"><span class="pre">Edge.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.__init__"><code class="docutils literal notranslate"><span class="pre">Edge.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.__repr__"><code class="docutils literal notranslate"><span class="pre">Edge.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Edge.delete"><code class="docutils literal notranslate"><span class="pre">Edge.delete()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref"><code class="docutils literal notranslate"><span class="pre">Kref</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.uri"><code class="docutils literal notranslate"><span class="pre">Kref.uri</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.__eq__"><code class="docutils literal notranslate"><span class="pre">Kref.__eq__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.__hash__"><code class="docutils literal notranslate"><span class="pre">Kref.__hash__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.__new__"><code class="docutils literal notranslate"><span class="pre">Kref.__new__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.__repr__"><code class="docutils literal notranslate"><span class="pre">Kref.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.from_pb"><code class="docutils literal notranslate"><span class="pre">Kref.from_pb()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_artifact_name"><code class="docutils literal notranslate"><span class="pre">Kref.get_artifact_name()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_item_name"><code class="docutils literal notranslate"><span class="pre">Kref.get_item_name()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_kind"><code class="docutils literal notranslate"><span class="pre">Kref.get_kind()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_path"><code class="docutils literal notranslate"><span class="pre">Kref.get_path()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_project"><code class="docutils literal notranslate"><span class="pre">Kref.get_project()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_revision"><code class="docutils literal notranslate"><span class="pre">Kref.get_revision()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.get_space"><code class="docutils literal notranslate"><span class="pre">Kref.get_space()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Kref.to_pb"><code class="docutils literal notranslate"><span class="pre">Kref.to_pb()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id3"><code class="docutils literal notranslate"><span class="pre">Kref.uri</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event"><code class="docutils literal notranslate"><span class="pre">Event</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.routing_key"><code class="docutils literal notranslate"><span class="pre">Event.routing_key</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.kref"><code class="docutils literal notranslate"><span class="pre">Event.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.timestamp"><code class="docutils literal notranslate"><span class="pre">Event.timestamp</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.author"><code class="docutils literal notranslate"><span class="pre">Event.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.details"><code class="docutils literal notranslate"><span class="pre">Event.details</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.cursor"><code class="docutils literal notranslate"><span class="pre">Event.cursor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.__init__"><code class="docutils literal notranslate"><span class="pre">Event.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Event.__repr__"><code class="docutils literal notranslate"><span class="pre">Event.__repr__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.ProjectLimitError"><code class="docutils literal notranslate"><span class="pre">ProjectLimitError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle"><code class="docutils literal notranslate"><span class="pre">Bundle</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.kref"><code class="docutils literal notranslate"><span class="pre">Bundle.kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.name"><code class="docutils literal notranslate"><span class="pre">Bundle.name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.item_name"><code class="docutils literal notranslate"><span class="pre">Bundle.item_name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.kind"><code class="docutils literal notranslate"><span class="pre">Bundle.kind</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.metadata"><code class="docutils literal notranslate"><span class="pre">Bundle.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.created_at"><code class="docutils literal notranslate"><span class="pre">Bundle.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.author"><code class="docutils literal notranslate"><span class="pre">Bundle.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.username"><code class="docutils literal notranslate"><span class="pre">Bundle.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.deprecated"><code class="docutils literal notranslate"><span class="pre">Bundle.deprecated</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.__init__"><code class="docutils literal notranslate"><span class="pre">Bundle.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.__repr__"><code class="docutils literal notranslate"><span class="pre">Bundle.__repr__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.add_member"><code class="docutils literal notranslate"><span class="pre">Bundle.add_member()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.get_history"><code class="docutils literal notranslate"><span class="pre">Bundle.get_history()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.get_members"><code class="docutils literal notranslate"><span class="pre">Bundle.get_members()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.Bundle.remove_member"><code class="docutils literal notranslate"><span class="pre">Bundle.remove_member()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleMember"><code class="docutils literal notranslate"><span class="pre">BundleMember</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleMember.item_kref"><code class="docutils literal notranslate"><span class="pre">BundleMember.item_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleMember.added_at"><code class="docutils literal notranslate"><span class="pre">BundleMember.added_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleMember.added_by"><code class="docutils literal notranslate"><span class="pre">BundleMember.added_by</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleMember.added_by_username"><code class="docutils literal notranslate"><span class="pre">BundleMember.added_by_username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleMember.added_in_revision"><code class="docutils literal notranslate"><span class="pre">BundleMember.added_in_revision</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleMember.__init__"><code class="docutils literal notranslate"><span class="pre">BundleMember.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id4"><code class="docutils literal notranslate"><span class="pre">BundleMember.item_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id5"><code class="docutils literal notranslate"><span class="pre">BundleMember.added_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id6"><code class="docutils literal notranslate"><span class="pre">BundleMember.added_by</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id7"><code class="docutils literal notranslate"><span class="pre">BundleMember.added_by_username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id8"><code class="docutils literal notranslate"><span class="pre">BundleMember.added_in_revision</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleRevisionHistory"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleRevisionHistory.revision_number"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.revision_number</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleRevisionHistory.action"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.action</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleRevisionHistory.member_item_kref"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.member_item_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleRevisionHistory.author"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleRevisionHistory.username"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleRevisionHistory.created_at"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleRevisionHistory.metadata"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.metadata</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.BundleRevisionHistory.__init__"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id9"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.revision_number</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id10"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.action</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id11"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.member_item_kref</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id12"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.author</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id13"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.username</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id14"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.created_at</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id15"><code class="docutils literal notranslate"><span class="pre">BundleRevisionHistory.metadata</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.ReservedKindError"><code class="docutils literal notranslate"><span class="pre">ReservedKindError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.KrefValidationError"><code class="docutils literal notranslate"><span class="pre">KrefValidationError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeTypeValidationError"><code class="docutils literal notranslate"><span class="pre">EdgeTypeValidationError</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.validate_kref"><code class="docutils literal notranslate"><span class="pre">validate_kref()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.validate_edge_type"><code class="docutils literal notranslate"><span class="pre">validate_edge_type()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.is_valid_kref"><code class="docutils literal notranslate"><span class="pre">is_valid_kref()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.is_valid_edge_type"><code class="docutils literal notranslate"><span class="pre">is_valid_edge_type()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.connect"><code class="docutils literal notranslate"><span class="pre">connect()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.use_client"><code class="docutils literal notranslate"><span class="pre">use_client</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.use_client.__init__"><code class="docutils literal notranslate"><span class="pre">use_client.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.use_client.__enter__"><code class="docutils literal notranslate"><span class="pre">use_client.__enter__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.use_client.__exit__"><code class="docutils literal notranslate"><span class="pre">use_client.__exit__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_client"><code class="docutils literal notranslate"><span class="pre">get_client()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.configure_default_client"><code class="docutils literal notranslate"><span class="pre">configure_default_client()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.auto_configure_from_discovery"><code class="docutils literal notranslate"><span class="pre">auto_configure_from_discovery()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#id16"><code class="docutils literal notranslate"><span class="pre">LATEST_TAG</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#id17"><code class="docutils literal notranslate"><span class="pre">PUBLISHED_TAG</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeType"><code class="docutils literal notranslate"><span class="pre">EdgeType</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeType.BELONGS_TO"><code class="docutils literal notranslate"><span class="pre">EdgeType.BELONGS_TO</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeType.CREATED_FROM"><code class="docutils literal notranslate"><span class="pre">EdgeType.CREATED_FROM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeType.REFERENCED"><code class="docutils literal notranslate"><span class="pre">EdgeType.REFERENCED</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeType.DEPENDS_ON"><code class="docutils literal notranslate"><span class="pre">EdgeType.DEPENDS_ON</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeType.DERIVED_FROM"><code class="docutils literal notranslate"><span class="pre">EdgeType.DERIVED_FROM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeType.CONTAINS"><code class="docutils literal notranslate"><span class="pre">EdgeType.CONTAINS</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id18"><code class="docutils literal notranslate"><span class="pre">EdgeType.BELONGS_TO</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id19"><code class="docutils literal notranslate"><span class="pre">EdgeType.CONTAINS</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id20"><code class="docutils literal notranslate"><span class="pre">EdgeType.CREATED_FROM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id21"><code class="docutils literal notranslate"><span class="pre">EdgeType.DEPENDS_ON</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id22"><code class="docutils literal notranslate"><span class="pre">EdgeType.DERIVED_FROM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id23"><code class="docutils literal notranslate"><span class="pre">EdgeType.REFERENCED</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeDirection"><code class="docutils literal notranslate"><span class="pre">EdgeDirection</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeDirection.OUTGOING"><code class="docutils literal notranslate"><span class="pre">EdgeDirection.OUTGOING</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeDirection.INCOMING"><code class="docutils literal notranslate"><span class="pre">EdgeDirection.INCOMING</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EdgeDirection.BOTH"><code class="docutils literal notranslate"><span class="pre">EdgeDirection.BOTH</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id24"><code class="docutils literal notranslate"><span class="pre">EdgeDirection.BOTH</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id25"><code class="docutils literal notranslate"><span class="pre">EdgeDirection.INCOMING</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id26"><code class="docutils literal notranslate"><span class="pre">EdgeDirection.OUTGOING</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_tenant_info"><code class="docutils literal notranslate"><span class="pre">get_tenant_info()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_tenant_slug"><code class="docutils literal notranslate"><span class="pre">get_tenant_slug()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.create_project"><code class="docutils literal notranslate"><span class="pre">create_project()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_projects"><code class="docutils literal notranslate"><span class="pre">get_projects()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_project"><code class="docutils literal notranslate"><span class="pre">get_project()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.delete_project"><code class="docutils literal notranslate"><span class="pre">delete_project()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.item_search"><code class="docutils literal notranslate"><span class="pre">item_search()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_item"><code class="docutils literal notranslate"><span class="pre">get_item()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_bundle"><code class="docutils literal notranslate"><span class="pre">get_bundle()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_revision"><code class="docutils literal notranslate"><span class="pre">get_revision()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_artifact"><code class="docutils literal notranslate"><span class="pre">get_artifact()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_artifacts_by_location"><code class="docutils literal notranslate"><span class="pre">get_artifacts_by_location()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.set_attribute"><code class="docutils literal notranslate"><span class="pre">set_attribute()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_attribute"><code class="docutils literal notranslate"><span class="pre">get_attribute()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.delete_attribute"><code class="docutils literal notranslate"><span class="pre">delete_attribute()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.event_stream"><code class="docutils literal notranslate"><span class="pre">event_stream()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.get_event_capabilities"><code class="docutils literal notranslate"><span class="pre">get_event_capabilities()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.EventCapabilities"><code class="docutils literal notranslate"><span class="pre">EventCapabilities</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EventCapabilities.supports_replay"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.supports_replay</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EventCapabilities.supports_cursor"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.supports_cursor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EventCapabilities.supports_consumer_groups"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.supports_consumer_groups</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EventCapabilities.max_retention_hours"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.max_retention_hours</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EventCapabilities.max_buffer_size"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.max_buffer_size</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EventCapabilities.tier"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.tier</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#kumiho.EventCapabilities.__init__"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id27"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.supports_replay</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id28"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.supports_cursor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id29"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.supports_consumer_groups</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id30"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.max_retention_hours</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id31"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.max_buffer_size</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/kumiho.html#id32"><code class="docutils literal notranslate"><span class="pre">EventCapabilities.tier</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/kumiho.html#kumiho.resolve"><code class="docutils literal notranslate"><span class="pre">resolve()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/project.html">kumiho.project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/space.html">kumiho.space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/item.html">kumiho.item</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/bundle.html">kumiho.bundle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/revision.html">kumiho.revision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/artifact.html">kumiho.artifact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/edge.html">kumiho.edge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/kref.html">kumiho.kref</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/mcp_server.html">MCP Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_list_projects"><code class="docutils literal notranslate"><span class="pre">tool_list_projects()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_project"><code class="docutils literal notranslate"><span class="pre">tool_get_project()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_spaces"><code class="docutils literal notranslate"><span class="pre">tool_get_spaces()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_space"><code class="docutils literal notranslate"><span class="pre">tool_get_space()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_item"><code class="docutils literal notranslate"><span class="pre">tool_get_item()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_revision"><code class="docutils literal notranslate"><span class="pre">tool_get_revision()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_artifacts"><code class="docutils literal notranslate"><span class="pre">tool_get_artifacts()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_artifact"><code class="docutils literal notranslate"><span class="pre">tool_get_artifact()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_bundle"><code class="docutils literal notranslate"><span class="pre">tool_get_bundle()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_search_items"><code class="docutils literal notranslate"><span class="pre">tool_search_items()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_dependencies"><code class="docutils literal notranslate"><span class="pre">tool_get_dependencies()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_dependents"><code class="docutils literal notranslate"><span class="pre">tool_get_dependents()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_provenance_summary"><code class="docutils literal notranslate"><span class="pre">tool_get_provenance_summary()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_analyze_impact"><code class="docutils literal notranslate"><span class="pre">tool_analyze_impact()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_find_path"><code class="docutils literal notranslate"><span class="pre">tool_find_path()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_edges"><code class="docutils literal notranslate"><span class="pre">tool_get_edges()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_resolve_kref"><code class="docutils literal notranslate"><span class="pre">tool_resolve_kref()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_artifacts_by_location"><code class="docutils literal notranslate"><span class="pre">tool_get_artifacts_by_location()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_item_revisions"><code class="docutils literal notranslate"><span class="pre">tool_get_item_revisions()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_revision_by_tag"><code class="docutils literal notranslate"><span class="pre">tool_get_revision_by_tag()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_create_revision"><code class="docutils literal notranslate"><span class="pre">tool_create_revision()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_tag_revision"><code class="docutils literal notranslate"><span class="pre">tool_tag_revision()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_create_edge"><code class="docutils literal notranslate"><span class="pre">tool_create_edge()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_create_project"><code class="docutils literal notranslate"><span class="pre">tool_create_project()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_create_space"><code class="docutils literal notranslate"><span class="pre">tool_create_space()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_create_item"><code class="docutils literal notranslate"><span class="pre">tool_create_item()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_create_artifact"><code class="docutils literal notranslate"><span class="pre">tool_create_artifact()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_create_bundle"><code class="docutils literal notranslate"><span class="pre">tool_create_bundle()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_delete_project"><code class="docutils literal notranslate"><span class="pre">tool_delete_project()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_delete_space"><code class="docutils literal notranslate"><span class="pre">tool_delete_space()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_delete_item"><code class="docutils literal notranslate"><span class="pre">tool_delete_item()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_delete_revision"><code class="docutils literal notranslate"><span class="pre">tool_delete_revision()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_delete_artifact"><code class="docutils literal notranslate"><span class="pre">tool_delete_artifact()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_delete_edge"><code class="docutils literal notranslate"><span class="pre">tool_delete_edge()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_untag_revision"><code class="docutils literal notranslate"><span class="pre">tool_untag_revision()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_set_metadata"><code class="docutils literal notranslate"><span class="pre">tool_set_metadata()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_deprecate_item"><code class="docutils literal notranslate"><span class="pre">tool_deprecate_item()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_add_bundle_member"><code class="docutils literal notranslate"><span class="pre">tool_add_bundle_member()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_remove_bundle_member"><code class="docutils literal notranslate"><span class="pre">tool_remove_bundle_member()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.tool_get_bundle_members"><code class="docutils literal notranslate"><span class="pre">tool_get_bundle_members()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.create_mcp_server"><code class="docutils literal notranslate"><span class="pre">create_mcp_server()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.run_server"><code class="docutils literal notranslate"><span class="pre">run_server()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#kumiho.mcp_server.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/mcp_server.html#tool-definitions">Tool Definitions</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id1">[0.4.0] - 2025-12-03</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#added">Added</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#changed">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#xx-xx">[0.3.0] - 2024-XX-XX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id2">Added</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id3">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#fixed">Fixed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id4">[0.2.0] - 2024-XX-XX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id5">Added</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id6">Changed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id7">[0.1.0] - 2024-XX-XX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html#id8">Added</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#development-setup">Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#code-style">Code Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#pull-request-process">Pull Request Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#license">License</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Kumiho Python SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../kumiho.html">kumiho</a></li>
      <li class="breadcrumb-item active">kumiho.client</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for kumiho.client</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Low-level gRPC client for the Kumiho Cloud service.</span>

<span class="sd">This module provides the internal ``_Client`` class that handles all gRPC</span>
<span class="sd">communication with Kumiho Cloud servers. It manages:</span>

<span class="sd">- Connection establishment (TLS/insecure, target resolution)</span>
<span class="sd">- Authentication (Bearer token injection)</span>
<span class="sd">- Discovery-based tenant routing</span>
<span class="sd">- All gRPC method calls</span>

<span class="sd">The ``_Client`` class is not intended to be used directly by end users.</span>
<span class="sd">Instead, use the high-level functions and classes exposed by the ``kumiho``</span>
<span class="sd">package, such as :func:`kumiho.connect`, :class:`kumiho.Project`, etc.</span>

<span class="sd">Example:</span>
<span class="sd">    Internal usage (not recommended for end users)::</span>

<span class="sd">        from kumiho.client import _Client</span>

<span class="sd">        client = _Client(target=&quot;us-central.kumiho.cloud:443&quot;)</span>
<span class="sd">        space = client.create_space(project_kref, &quot;my-space&quot;)</span>

<span class="sd">    Preferred high-level usage::</span>

<span class="sd">        import kumiho</span>

<span class="sd">        kumiho.connect()</span>
<span class="sd">        project = kumiho.create_project(name=&quot;my-project&quot;)</span>

<span class="sd">Attributes:</span>
<span class="sd">    _LOGGER: Module-level logger for client operations.</span>
<span class="sd">    _DISCOVERY_DISABLE_ENV: Environment variable to disable auto-discovery.</span>
<span class="sd">    _FORCE_REFRESH_ENV: Environment variable to force discovery cache refresh.</span>

<span class="sd">Note:</span>
<span class="sd">    This module is considered internal API. The public interface may change</span>
<span class="sd">    between minor versions. Use the ``kumiho`` package-level API instead.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">grpc</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">google.protobuf.json_format</span><span class="w"> </span><span class="kn">import</span> <span class="n">MessageToDict</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">._token_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_bearer_token</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.discovery</span><span class="w"> </span><span class="kn">import</span> <span class="n">DiscoveryError</span><span class="p">,</span> <span class="n">DiscoveryManager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.proto</span><span class="w"> </span><span class="kn">import</span> <span class="n">kumiho_pb2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.proto</span><span class="w"> </span><span class="kn">import</span> <span class="n">kumiho_pb2_grpc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.event</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.space</span><span class="w"> </span><span class="kn">import</span> <span class="n">Space</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.kref</span><span class="w"> </span><span class="kn">import</span> <span class="n">Kref</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.proto.kumiho_pb2</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">CreateSpaceRequest</span><span class="p">,</span>
    <span class="n">CreateEdgeRequest</span><span class="p">,</span>
    <span class="n">CreateItemRequest</span><span class="p">,</span>
    <span class="n">CreateArtifactRequest</span><span class="p">,</span>
    <span class="n">CreateRevisionRequest</span><span class="p">,</span>
    <span class="n">CreateProjectRequest</span><span class="p">,</span>
    <span class="n">DeleteSpaceRequest</span><span class="p">,</span>
    <span class="n">DeleteEdgeRequest</span><span class="p">,</span>
    <span class="n">DeleteItemRequest</span><span class="p">,</span>
    <span class="n">DeleteArtifactRequest</span><span class="p">,</span>
    <span class="n">DeleteRevisionRequest</span><span class="p">,</span>
    <span class="n">DeleteProjectRequest</span><span class="p">,</span>
    <span class="n">DeleteAttributeRequest</span><span class="p">,</span>
    <span class="n">EventStreamRequest</span><span class="p">,</span>
    <span class="n">GetAttributeRequest</span><span class="p">,</span>
    <span class="n">GetChildSpacesRequest</span><span class="p">,</span>
    <span class="n">GetSpaceRequest</span><span class="p">,</span>
    <span class="n">GetEdgesRequest</span><span class="p">,</span>
    <span class="n">GetItemRequest</span><span class="p">,</span>
    <span class="n">GetItemsRequest</span><span class="p">,</span>
    <span class="n">GetProjectsRequest</span><span class="p">,</span>
    <span class="n">GetArtifactRequest</span><span class="p">,</span>
    <span class="n">GetArtifactsRequest</span><span class="p">,</span>
    <span class="n">GetArtifactsByLocationRequest</span><span class="p">,</span>
    <span class="n">GetTenantUsageRequest</span><span class="p">,</span>
    <span class="n">GetRevisionsRequest</span><span class="p">,</span>
    <span class="n">GetEventCapabilitiesRequest</span><span class="p">,</span>
    <span class="n">HasTagRequest</span><span class="p">,</span>
    <span class="n">KrefRequest</span><span class="p">,</span>
    <span class="n">Edge</span> <span class="k">as</span> <span class="n">PbEdge</span><span class="p">,</span>
    <span class="n">EdgeDirection</span><span class="p">,</span>
    <span class="n">PeekNextRevisionRequest</span><span class="p">,</span>
    <span class="n">ItemSearchRequest</span><span class="p">,</span>
    <span class="n">ResolveKrefRequest</span><span class="p">,</span>
    <span class="n">ResolveLocationRequest</span><span class="p">,</span>
    <span class="n">SetAttributeRequest</span><span class="p">,</span>
    <span class="n">SetDefaultArtifactRequest</span><span class="p">,</span>
    <span class="n">TagRevisionRequest</span><span class="p">,</span>
    <span class="n">UnTagRevisionRequest</span><span class="p">,</span>
    <span class="n">UpdateMetadataRequest</span><span class="p">,</span>
    <span class="n">WasTaggedRequest</span><span class="p">,</span>
    <span class="n">SetDeprecatedRequest</span><span class="p">,</span>
    <span class="n">TraverseEdgesRequest</span><span class="p">,</span>
    <span class="n">ShortestPathRequest</span><span class="p">,</span>
    <span class="n">ImpactAnalysisRequest</span><span class="p">,</span>
    <span class="n">CreateBundleRequest</span><span class="p">,</span>
    <span class="n">AddBundleMemberRequest</span><span class="p">,</span>
    <span class="n">RemoveBundleMemberRequest</span><span class="p">,</span>
    <span class="n">GetBundleMembersRequest</span><span class="p">,</span>
    <span class="n">GetBundleHistoryRequest</span><span class="p">,</span>
    <span class="n">PaginationRequest</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.edge</span><span class="w"> </span><span class="kn">import</span> <span class="n">Edge</span><span class="p">,</span> <span class="n">TraversalResult</span><span class="p">,</span> <span class="n">ImpactedRevision</span><span class="p">,</span> <span class="n">ShortestPathResult</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.proto.kumiho_pb2</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProjectResponse</span><span class="p">,</span> <span class="n">StatusResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.project</span><span class="w"> </span><span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.item</span><span class="w"> </span><span class="kn">import</span> <span class="n">Item</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.artifact</span><span class="w"> </span><span class="kn">import</span> <span class="n">Artifact</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.revision</span><span class="w"> </span><span class="kn">import</span> <span class="n">Revision</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">PagedList</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.bundle</span><span class="w"> </span><span class="kn">import</span> <span class="n">Bundle</span><span class="p">,</span> <span class="n">BundleMember</span><span class="p">,</span> <span class="n">BundleRevisionHistory</span>


<span class="n">_LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;kumiho.client&quot;</span><span class="p">)</span>
<span class="n">_DISCOVERY_DISABLE_ENV</span> <span class="o">=</span> <span class="s2">&quot;KUMIHO_DISABLE_AUTO_DISCOVERY&quot;</span>
<span class="n">_FORCE_REFRESH_ENV</span> <span class="o">=</span> <span class="s2">&quot;KUMIHO_FORCE_DISCOVERY_REFRESH&quot;</span>


<div class="viewcode-block" id="ProjectLimitError">
<a class="viewcode-back" href="../../api/kumiho.html#kumiho.ProjectLimitError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ProjectLimitError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when guardrails block project creation (e.g., max projects reached).&quot;&quot;&quot;</span></div>



<span class="k">class</span><span class="w"> </span><span class="nc">_Client</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Low-level gRPC client for interacting with the Kumiho Cloud service.</span>

<span class="sd">    This client provides direct access to all Kumiho gRPC endpoints for</span>
<span class="sd">    managing projects, spaces, items, revisions, artifacts, and edges.</span>
<span class="sd">    It handles connection management, authentication, and discovery-based</span>
<span class="sd">    tenant routing automatically.</span>

<span class="sd">    The client is typically not instantiated directly. Instead, use</span>
<span class="sd">    :func:`kumiho.connect` which manages a context-variable-scoped client</span>
<span class="sd">    instance.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        channel (grpc.Channel): The gRPC channel to the Kumiho server.</span>
<span class="sd">        stub (KumihoGraphStub): The gRPC stub for making service calls.</span>

<span class="sd">    Example:</span>
<span class="sd">        Using the client directly (not recommended)::</span>

<span class="sd">            from kumiho.client import _Client</span>

<span class="sd">            client = _Client(</span>
<span class="sd">                target=&quot;us-central.kumiho.cloud:443&quot;,</span>
<span class="sd">                auth_token=&quot;eyJhbG...&quot;</span>
<span class="sd">            )</span>
<span class="sd">            projects = client.get_projects()</span>

<span class="sd">        Using via kumiho.connect (recommended)::</span>

<span class="sd">            import kumiho</span>

<span class="sd">            kumiho.connect()</span>
<span class="sd">            projects = kumiho.list_projects()</span>

<span class="sd">    Note:</span>
<span class="sd">        This class is considered internal API. Use the public ``kumiho``</span>
<span class="sd">        module functions instead for stable interfaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">auth_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_discovery</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tenant_hint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">force_discovery_refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">enable_auto_login</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the gRPC client with connection and authentication settings.</span>

<span class="sd">        The client resolves the target server using the following priority:</span>

<span class="sd">        1. Explicit ``target`` parameter</span>
<span class="sd">        2. Discovery endpoint (if enabled and token available)</span>
<span class="sd">        3. ``KUMIHO_SERVER_ENDPOINT`` environment variable</span>
<span class="sd">        4. ``KUMIHO_SERVER_ADDRESS`` environment variable (legacy)</span>
<span class="sd">        5. ``localhost:8080`` (default for local development)</span>

<span class="sd">        Args:</span>
<span class="sd">            target: Server endpoint. Accepts formats:</span>

<span class="sd">                - ``host:port`` â€” plain gRPC</span>
<span class="sd">                - ``https://host`` â€” secure gRPC on port 443</span>
<span class="sd">                - ``grpcs://host:port`` â€” secure gRPC on custom port</span>

<span class="sd">                If None, the client attempts discovery or falls back to</span>
<span class="sd">                environment variables.</span>
<span class="sd">            auth_token: Bearer token for authentication. Sent as</span>
<span class="sd">                ``Authorization: Bearer &lt;token&gt;`` on every RPC. If not</span>
<span class="sd">                provided, falls back to:</span>

<span class="sd">                - ``KUMIHO_AUTH_TOKEN`` environment variable</span>
<span class="sd">                - Token file from ``kumiho-auth`` CLI cache</span>
<span class="sd">            default_metadata: Additional gRPC metadata to attach to all</span>
<span class="sd">                outbound RPCs. Each entry is a ``(key, value)`` tuple.</span>
<span class="sd">            use_discovery: Whether to use the discovery endpoint for</span>
<span class="sd">                tenant routing. Defaults to True unless disabled via</span>
<span class="sd">                ``KUMIHO_DISABLE_AUTO_DISCOVERY=true``.</span>
<span class="sd">            tenant_hint: Optional tenant ID hint for discovery or direct</span>
<span class="sd">                tenant header injection when discovery is disabled.</span>
<span class="sd">            force_discovery_refresh: Force refresh of discovery cache.</span>
<span class="sd">                Overrides ``KUMIHO_FORCE_DISCOVERY_REFRESH`` env var.</span>
<span class="sd">            enable_auto_login: Whether to enable auto-login when no</span>
<span class="sd">                credentials are available. Defaults to True.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the connection cannot be established.</span>
<span class="sd">            DiscoveryError: If discovery fails and no fallback is available.</span>

<span class="sd">        Example:</span>
<span class="sd">            Basic initialization::</span>

<span class="sd">                client = _Client()  # Uses defaults</span>

<span class="sd">            With explicit settings::</span>

<span class="sd">                client = _Client(</span>
<span class="sd">                    target=&quot;us-central.kumiho.cloud:443&quot;,</span>
<span class="sd">                    auth_token=&quot;eyJhbG...&quot;,</span>
<span class="sd">                    default_metadata=[(&quot;x-custom-header&quot;, &quot;value&quot;)]</span>
<span class="sd">                )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">default_metadata</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="n">resolved_token</span> <span class="o">=</span> <span class="n">auth_token</span> <span class="ow">or</span> <span class="n">load_bearer_token</span><span class="p">()</span>

        <span class="n">discovery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_resolve_via_discovery</span><span class="p">(</span>
            <span class="n">explicit_target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
            <span class="n">use_discovery</span><span class="o">=</span><span class="n">use_discovery</span><span class="p">,</span>
            <span class="n">id_token</span><span class="o">=</span><span class="n">resolved_token</span><span class="p">,</span>
            <span class="n">tenant_hint</span><span class="o">=</span><span class="n">tenant_hint</span><span class="p">,</span>
            <span class="n">force_discovery_refresh</span><span class="o">=</span><span class="n">force_discovery_refresh</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tenant_header_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">discovery</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">discovery</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">discovery</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">discovery</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;x-tenant-id&quot;</span><span class="p">,</span> <span class="n">discovery</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">tenant_header_set</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">tenant_hint</span><span class="p">:</span>
            <span class="c1"># Fallback: if discovery didn&#39;t run (e.g. no token), use the hint directly</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;x-tenant-id&quot;</span><span class="p">,</span> <span class="n">tenant_hint</span><span class="p">))</span>
            <span class="n">tenant_header_set</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_ENDPOINT&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_ADDRESS&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="s2">&quot;localhost:8080&quot;</span>
            <span class="p">)</span>

        <span class="n">authority_override</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_AUTHORITY&quot;</span><span class="p">)</span>
        <span class="n">ssl_override</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SSL_TARGET_OVERRIDE&quot;</span><span class="p">)</span>
        <span class="n">ca_bundle</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_CA_FILE&quot;</span><span class="p">)</span>
        <span class="n">use_tls_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_SERVER_USE_TLS&quot;</span><span class="p">)</span>

        <span class="n">address</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">use_tls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalise_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_tls_env</span><span class="p">:</span>
            <span class="n">use_tls</span> <span class="o">=</span> <span class="n">use_tls_env</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">authority_override</span><span class="p">:</span>
            <span class="n">authority</span> <span class="o">=</span> <span class="n">authority_override</span>

        <span class="k">if</span> <span class="n">use_tls</span><span class="p">:</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_ssl_credentials</span><span class="p">(</span><span class="n">ca_bundle</span><span class="p">)</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;grpc.default_authority&quot;</span><span class="p">,</span> <span class="n">authority</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">ssl_override</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;grpc.ssl_target_name_override&quot;</span><span class="p">,</span> <span class="n">ssl_override</span><span class="p">))</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">secure_channel</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">insecure_channel</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">resolved_token</span><span class="p">:</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;authorization&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">resolved_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="c1"># Apply interceptors in order: correlation ID, auto-login, then metadata injection</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">intercept_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">_CorrelationIdInterceptor</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">enable_auto_login</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">intercept_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">_AutoLoginInterceptor</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">intercept_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">_MetadataInjector</span><span class="p">(</span><span class="n">metadata</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span> <span class="o">=</span> <span class="n">kumiho_pb2_grpc</span><span class="o">.</span><span class="n">KumihoServiceStub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_env_flag</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_maybe_resolve_via_discovery</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">explicit_target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">use_discovery</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
        <span class="n">id_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">tenant_hint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">force_discovery_refresh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="k">if</span> <span class="n">explicit_target</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">should_use</span> <span class="o">=</span> <span class="n">use_discovery</span>
        <span class="k">if</span> <span class="n">should_use</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">should_use</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_flag</span><span class="p">(</span><span class="n">_DISCOVERY_DISABLE_ENV</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">should_use</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">id_token</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Discovery skipped: no Firebase token available&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">hint</span> <span class="o">=</span> <span class="n">tenant_hint</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="n">force_refresh</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">force_discovery_refresh</span>
            <span class="k">if</span> <span class="n">force_discovery_refresh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env_flag</span><span class="p">(</span><span class="n">_FORCE_REFRESH_ENV</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">manager</span> <span class="o">=</span> <span class="n">DiscoveryManager</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">record</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span>
                <span class="n">id_token</span><span class="o">=</span><span class="n">id_token</span><span class="p">,</span>
                <span class="n">tenant_hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span>
                <span class="n">force_refresh</span><span class="o">=</span><span class="n">force_refresh</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">DiscoveryError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Discovery failed (</span><span class="si">%s</span><span class="s2">); falling back to legacy target&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pragma: no cover - defensive logging</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unexpected discovery failure; falling back to legacy target&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">target</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">grpc_authority</span> <span class="ow">or</span> <span class="n">record</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">server_url</span>
        <span class="n">tenant_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">tenant_id</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Resolved Kumiho endpoint via discovery: target=</span><span class="si">%s</span><span class="s2"> tenant=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">tenant_id</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">target</span><span class="p">,</span> <span class="n">tenant_id</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_normalise_target</span><span class="p">(</span><span class="n">raw_target</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the provided target into an address, authority, and TLS flag.&quot;&quot;&quot;</span>

        <span class="n">target</span> <span class="o">=</span> <span class="n">raw_target</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Kumiho client target cannot be empty&quot;</span><span class="p">)</span>

        <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;://&quot;</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">hostname</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">port</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid Kumiho endpoint: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="s2">&quot;grpcs&quot;</span><span class="p">}:</span>
                    <span class="n">port</span> <span class="o">=</span> <span class="mi">443</span>
                <span class="k">elif</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;grpc&quot;</span><span class="p">}:</span>
                    <span class="n">port</span> <span class="o">=</span> <span class="mi">80</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="c1"># Strip any trailing path components</span>
            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
                <span class="n">host</span><span class="p">,</span> <span class="n">port_str</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">port_str</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">host</span> <span class="o">=</span> <span class="n">target</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid Kumiho endpoint: </span><span class="si">{</span><span class="n">raw_target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="mi">443</span> <span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="s2">&quot;grpcs&quot;</span><span class="p">}</span> <span class="k">else</span> <span class="mi">8080</span>

        <span class="n">authority</span> <span class="o">=</span> <span class="n">host</span>
        <span class="n">address</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">use_tls</span> <span class="o">=</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="s2">&quot;grpcs&quot;</span><span class="p">}</span> <span class="ow">or</span> <span class="n">port</span> <span class="o">==</span> <span class="mi">443</span>
        
        <span class="c1"># Security: Warn if connecting to non-localhost without TLS</span>
        <span class="n">is_localhost</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;::1&quot;</span><span class="p">}</span>
        <span class="n">require_tls</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUMIHO_REQUIRE_TLS&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_localhost</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">use_tls</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">require_tls</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;TLS is required but connecting to </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2"> without TLS. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Use https:// or set port 443.&quot;</span>
                <span class="p">)</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Connecting to </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2"> without TLS. Credentials may be transmitted &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;in plaintext. Set KUMIHO_SERVER_USE_TLS=true or use https:// for production.&quot;</span><span class="p">,</span>
                <span class="ne">UserWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">address</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">use_tls</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_ssl_credentials</span><span class="p">(</span><span class="n">ca_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ChannelCredentials</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create SSL credentials, optionally using a custom CA bundle.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ca_file</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ca_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">root_certs</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ssl_channel_credentials</span><span class="p">(</span><span class="n">root_certificates</span><span class="o">=</span><span class="n">root_certs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ssl_channel_credentials</span><span class="p">()</span>

    <span class="c1"># Project methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateProjectRequest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateProject</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">code</span><span class="p">()</span> <span class="o">==</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">RESOURCE_EXHAUSTED</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ProjectLimitError</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">details</span><span class="p">())</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">Project</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Project</span><span class="p">]:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetProjectsRequest</span><span class="p">()</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetProjects</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Project</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">pb</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">projects</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Project</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the first project matching the given name, or None if not found.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_projects</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">project</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusResponse</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteProjectRequest</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteProject</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">allow_public</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;project_id&quot;</span><span class="p">:</span> <span class="n">project_id</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">allow_public</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;allow_public&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">allow_public</span>
        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kumiho_pb2</span><span class="o">.</span><span class="n">UpdateProjectRequest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateProject</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Project</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Space methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">space_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Space</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new space.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent space.</span>
<span class="sd">            space_name: The name of the new space.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Space object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateSpaceRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">space_name</span><span class="o">=</span><span class="n">space_name</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateSpace</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Space</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Space</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a space by its path.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path of the space to retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Space object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetSpaceRequest</span><span class="p">(</span><span class="n">path_or_kref</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetSpace</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Space</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_child_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Space</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get child spaces of a parent space.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent space. If empty or &quot;/&quot;,</span>
<span class="sd">                         returns root-level spaces.</span>
<span class="sd">            recursive: Whether to fetch all descendant spaces recursively.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Space objects that are direct children of the parent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetChildSpacesRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetChildSpaces</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Space</span><span class="p">(</span><span class="n">space_resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">space_resp</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">spaces</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_space_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Space</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metadata for a space.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the space.</span>
<span class="sd">            metadata: The metadata to update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The updated Space object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UpdateMetadataRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateSpaceMetadata</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Space</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Item methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">item_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Item</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new item.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent space.</span>
<span class="sd">            item_name: The name of the item.</span>
<span class="sd">            kind: The kind of the item (e.g., &quot;model&quot;, &quot;texture&quot;).</span>
<span class="sd">            metadata: Metadata dictionary for the item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Item object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ReservedKindError: If kind is reserved (e.g., &#39;bundle&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.bundle</span><span class="w"> </span><span class="kn">import</span> <span class="n">RESERVED_KINDS</span><span class="p">,</span> <span class="n">ReservedKindError</span>
        
        <span class="k">if</span> <span class="n">kind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">RESERVED_KINDS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ReservedKindError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Item kind &#39;</span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2">&#39; is reserved. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Use the dedicated create_bundle() method instead.&quot;</span>
            <span class="p">)</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateItemRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">item_name</span><span class="o">=</span><span class="n">item_name</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateItem</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># resp.kref is a protobuf Kref message; update_item_metadata expects a kumiho.Kref</span>
            <span class="c1"># which provides .to_pb() for UpdateMetadataRequest.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_item_metadata</span><span class="p">(</span><span class="n">Kref</span><span class="o">.</span><span class="n">from_pb</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">kref</span><span class="p">),</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">item_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Item</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an item by its parent path, name, and kind.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent space.</span>
<span class="sd">            item_name: The name of the item.</span>
<span class="sd">            kind: The kind of the item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Item object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetItemRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">item_name</span><span class="o">=</span><span class="n">item_name</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetItem</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_item_by_kref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Item</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an item by its kref URI.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref_uri: The kref URI of the item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Item object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kref</span> <span class="o">=</span> <span class="n">Kref</span><span class="p">(</span><span class="n">kref_uri</span><span class="p">)</span>
        <span class="n">item_path</span> <span class="o">=</span> <span class="n">kref</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>  <span class="c1"># e.g., &quot;projectA/modelA.asset&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid item kref format: </span><span class="si">{</span><span class="n">kref</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">space_path</span><span class="p">,</span> <span class="n">item_name_kind</span> <span class="o">=</span> <span class="n">item_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">parent_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">space_path</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Add leading slash</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item_name_kind</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid item name.kind format: </span><span class="si">{</span><span class="n">item_name_kind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">item_name</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">item_name_kind</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">item_name</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_bundle_by_kref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Bundle&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a bundle by its kref URI.</span>

<span class="sd">        This method retrieves an item and verifies it is a bundle (kind=&#39;bundle&#39;).</span>
<span class="sd">        If the item exists but is not a bundle, raises a ValueError.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref_uri: The kref URI of the bundle</span>
<span class="sd">                (e.g., &quot;kref://project/space/mybundle.bundle&quot;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Bundle: The Bundle object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the item exists but is not a bundle (kind != &#39;bundle&#39;).</span>
<span class="sd">            grpc.RpcError: If the item is not found.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; bundle = client.get_bundle_by_kref(</span>
<span class="sd">            ...     &quot;kref://my-project/assets/character-bundle.bundle&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; members = bundle.get_members()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.bundle</span><span class="w"> </span><span class="kn">import</span> <span class="n">Bundle</span>
        
        <span class="c1"># First get the item</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item_by_kref</span><span class="p">(</span><span class="n">kref_uri</span><span class="p">)</span>
        
        <span class="c1"># Verify it&#39;s a bundle</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="s2">&quot;bundle&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Item &#39;</span><span class="si">{</span><span class="n">kref_uri</span><span class="si">}</span><span class="s2">&#39; is not a bundle (kind=&#39;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">kind</span><span class="si">}</span><span class="s2">&#39;). &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Use get_item() for non-bundle items.&quot;</span>
            <span class="p">)</span>
        
        <span class="c1"># Re-fetch as Bundle to get the Bundle wrapper with bundle-specific methods</span>
        <span class="n">kref</span> <span class="o">=</span> <span class="n">Kref</span><span class="p">(</span><span class="n">kref_uri</span><span class="p">)</span>
        <span class="n">item_path</span> <span class="o">=</span> <span class="n">kref</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>
        <span class="n">space_path</span><span class="p">,</span> <span class="n">item_name_kind</span> <span class="o">=</span> <span class="n">item_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">parent_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">space_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">bundle_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">item_name_kind</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Use GetItem to get the raw response and wrap as Bundle</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetItemRequest</span><span class="p">(</span><span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">item_name</span><span class="o">=</span><span class="n">bundle_name</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bundle&quot;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetItem</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Bundle</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_items</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">item_name_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">kind_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_deprecated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Item</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get items within a space with optional filtering.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path of the parent space.</span>
<span class="sd">            item_name_filter: Optional filter for item names.</span>
<span class="sd">            kind_filter: Optional filter for item kinds.</span>
<span class="sd">            page_size: Optional page size for pagination.</span>
<span class="sd">            cursor: Optional cursor for pagination.</span>
<span class="sd">            include_deprecated: Whether to include deprecated items.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Item objects matching the filters.</span>
<span class="sd">            If pagination is used, returns a PagedList.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pagination</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">page_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pagination</span> <span class="o">=</span> <span class="n">PaginationRequest</span><span class="p">(</span><span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span> <span class="ow">or</span> <span class="mi">100</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">GetItemsRequest</span><span class="p">(</span>
            <span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span>
            <span class="n">item_name_filter</span><span class="o">=</span><span class="n">item_name_filter</span><span class="p">,</span>
            <span class="n">kind_filter</span><span class="o">=</span><span class="n">kind_filter</span><span class="p">,</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">pagination</span><span class="p">,</span>
            <span class="n">include_deprecated</span><span class="o">=</span><span class="n">include_deprecated</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetItems</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">PagedList</span><span class="p">(</span>
                <span class="n">items</span><span class="p">,</span>
                <span class="n">next_cursor</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">pagination</span><span class="o">.</span><span class="n">next_cursor</span><span class="p">,</span>
                <span class="n">total_count</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">pagination</span><span class="o">.</span><span class="n">total_count</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">item_search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">item_name_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">kind_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_deprecated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Item</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for items across the system.</span>

<span class="sd">        Args:</span>
<span class="sd">            context_filter: Filter by context/path.</span>
<span class="sd">            item_name_filter: Filter by item name.</span>
<span class="sd">            kind_filter: Filter by item kind.</span>
<span class="sd">            page_size: Optional page size for pagination.</span>
<span class="sd">            cursor: Optional cursor for pagination.</span>
<span class="sd">            include_deprecated: Whether to include deprecated items.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Item objects matching the search criteria.</span>
<span class="sd">            If pagination is used, returns a PagedList.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pagination</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">page_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pagination</span> <span class="o">=</span> <span class="n">PaginationRequest</span><span class="p">(</span><span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span> <span class="ow">or</span> <span class="mi">100</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">req</span> <span class="o">=</span> <span class="n">ItemSearchRequest</span><span class="p">(</span>
            <span class="n">context_filter</span><span class="o">=</span><span class="n">context_filter</span><span class="p">,</span>
            <span class="n">item_name_filter</span><span class="o">=</span><span class="n">item_name_filter</span><span class="p">,</span>
            <span class="n">kind_filter</span><span class="o">=</span><span class="n">kind_filter</span><span class="p">,</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">pagination</span><span class="p">,</span>
            <span class="n">include_deprecated</span><span class="o">=</span><span class="n">include_deprecated</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ItemSearch</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">PagedList</span><span class="p">(</span>
                <span class="n">items</span><span class="p">,</span>
                <span class="n">next_cursor</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">pagination</span><span class="o">.</span><span class="n">next_cursor</span><span class="p">,</span>
                <span class="n">total_count</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">pagination</span><span class="o">.</span><span class="n">total_count</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_item_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Item</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metadata for an item.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the item.</span>
<span class="sd">            metadata: The metadata to update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The updated Item object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UpdateMetadataRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateItemMetadata</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Revision</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new revision for an item.</span>

<span class="sd">        Args:</span>
<span class="sd">            item_kref: The kref of the item.</span>
<span class="sd">            metadata: Optional metadata for the revision.</span>
<span class="sd">            number: Specific revision number to use (0 for auto-increment).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Revision object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateRevisionRequest</span><span class="p">(</span><span class="n">item_kref</span><span class="o">=</span><span class="n">item_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span> <span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateRevision</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Revision</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Revision</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a revision by its kref URI, with optional tag/time resolution.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref_uri: The kref URI of the revision. Can include ?t=tag or ?time=timestamp</span>
<span class="sd">                     for tag/time resolution.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Revision object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parse kref_uri for tag/time parameters</span>
        <span class="n">base_kref</span> <span class="o">=</span> <span class="n">kref_uri</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">kref_uri</span><span class="p">:</span>
            <span class="n">base_kref</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">kref_uri</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t=&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tag=&#39;</span><span class="p">):</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;time=&#39;</span><span class="p">):</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># Validate time format (YYYYMMDDHHMM)</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d</span><span class="si">{12}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;time must be in YYYYMMDDHHMM format&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use ResolveKref to find the specific revision</span>
            <span class="c1"># We pass the base_kref (Item Kref) and the constraints</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">ResolveKrefRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">base_kref</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ResolveKref</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Revision</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">()</span> <span class="o">==</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
                    <span class="c1"># Re-raise as NOT_FOUND</span>
                    <span class="n">context</span> <span class="o">=</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span><span class="p">()</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">NOT_FOUND</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s2">&quot;Revision not found&quot;</span>
                    <span class="k">raise</span> <span class="n">context</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">KrefRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kumiho_pb2</span><span class="o">.</span><span class="n">Kref</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">kref_uri</span><span class="p">))</span>
        
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetRevision</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Revision</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_item_from_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revision_kref</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Item</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the item that contains a specific revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            revision_kref: The kref URI of the revision.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Item object that contains the revision.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First get the revision to find its item relationship</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_revision</span><span class="p">(</span><span class="n">revision_kref</span><span class="p">)</span>
        <span class="c1"># Parse the item_kref to extract parent_path, item_name, and kind</span>
        <span class="n">item_path</span> <span class="o">=</span> <span class="n">revision</span><span class="o">.</span><span class="n">item_kref</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span>  <span class="c1"># e.g., &quot;space/item.kind&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid item kref format: </span><span class="si">{</span><span class="n">revision</span><span class="o">.</span><span class="n">item_kref</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">parent_path</span><span class="p">,</span> <span class="n">item_name_kind</span> <span class="o">=</span> <span class="n">item_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">parent_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">parent_path</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Add leading slash</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item_name_kind</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid item name.kind format: </span><span class="si">{</span><span class="n">item_name_kind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">item_name</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">item_name_kind</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">parent_path</span><span class="p">,</span> <span class="n">item_name</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_revisions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Revision</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all revisions of an item.</span>

<span class="sd">        Args:</span>
<span class="sd">            item_kref: The kref of the item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Revision objects for the item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetRevisionsRequest</span><span class="p">(</span><span class="n">item_kref</span><span class="o">=</span><span class="n">item_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">())</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetRevisions</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Revision</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">revisions</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_latest_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Revision</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the latest revision of an item.</span>

<span class="sd">        Args:</span>
<span class="sd">            item_kref: The kref of the item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The latest Revision object, or None if no revisions exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">ResolveKrefRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">item_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ResolveKref</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Revision</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">()</span> <span class="o">==</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the revision to delete.</span>
<span class="sd">            force: Whether to force deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteRevisionRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteRevision</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a space.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path of the space to delete.</span>
<span class="sd">            force: Whether to force deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteSpaceRequest</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteSpace</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete an item.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the item to delete.</span>
<span class="sd">            force: Whether to force deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteItemRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteItem</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_revision_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Revision</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metadata for a revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the revision.</span>
<span class="sd">            metadata: The metadata to update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The updated Revision object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UpdateMetadataRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateRevisionMetadata</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Revision</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">peek_next_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the next revision number that would be assigned to an item.</span>

<span class="sd">        Args:</span>
<span class="sd">            item_kref: The kref of the item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The next revision number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">PeekNextRevisionRequest</span><span class="p">(</span><span class="n">item_kref</span><span class="o">=</span><span class="n">item_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">())</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">PeekNextRevision</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">number</span>

    <span class="c1"># Tagging methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tag_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a tag to a revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the revision.</span>
<span class="sd">            tag: The tag to apply.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">TagRevisionRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">TagRevision</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">untag_revision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a tag from a revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the revision.</span>
<span class="sd">            tag: The tag to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UnTagRevisionRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UnTagRevision</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a revision has a specific tag.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the revision.</span>
<span class="sd">            tag: The tag to check for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the revision has the tag, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">HasTagRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">HasTag</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">has_tag</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">was_tagged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a revision was ever tagged with a specific tag.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the revision.</span>
<span class="sd">            tag: The tag to check for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the revision was ever tagged with the given tag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">WasTaggedRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">WasTagged</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">was_tagged</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_default_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revision_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">artifact_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the default artifact for a revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            revision_kref: The kref of the revision.</span>
<span class="sd">            artifact_name: The name of the artifact to set as default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">SetDefaultArtifactRequest</span><span class="p">(</span><span class="n">revision_kref</span><span class="o">=</span><span class="n">revision_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">artifact_name</span><span class="o">=</span><span class="n">artifact_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">SetDefaultArtifact</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="c1"># Artifact methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_artifact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">revision_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Artifact</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new artifact for a revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            revision_kref: The kref of the parent revision.</span>
<span class="sd">            name: The name of the artifact.</span>
<span class="sd">            location: The storage location of the artifact.</span>
<span class="sd">            metadata: Optional key-value metadata for the artifact.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Artifact object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateArtifactRequest</span><span class="p">(</span>
            <span class="n">revision_kref</span><span class="o">=</span><span class="n">revision_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateArtifact</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Artifact</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revision_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Artifact</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an artifact by revision kref and name.</span>

<span class="sd">        Args:</span>
<span class="sd">            revision_kref: The kref of the parent revision.</span>
<span class="sd">            name: The name of the artifact.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Artifact object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetArtifactRequest</span><span class="p">(</span><span class="n">revision_kref</span><span class="o">=</span><span class="n">revision_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetArtifact</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Artifact</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_artifact_by_kref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Artifact</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an artifact by its kref URI.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref_uri: The kref URI of the artifact (e.g., &quot;kref://space/item.kind?r=1&amp;a=artifact_name&quot;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Artifact object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the kref URI does not contain an artifact name and no default artifact</span>
<span class="sd">                can be resolved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kref</span> <span class="o">=</span> <span class="n">Kref</span><span class="p">(</span><span class="n">kref_uri</span><span class="p">)</span>
        <span class="n">artifact_name</span> <span class="o">=</span> <span class="n">kref</span><span class="o">.</span><span class="n">get_artifact_name</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">artifact_name</span><span class="p">:</span>
            <span class="c1"># Build the revision kref by removing the artifact part</span>
            <span class="n">revision_kref_uri</span> <span class="o">=</span> <span class="n">kref_uri</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;a=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">revision_kref</span> <span class="o">=</span> <span class="n">Kref</span><span class="p">(</span><span class="n">revision_kref_uri</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_artifact</span><span class="p">(</span><span class="n">revision_kref</span><span class="p">,</span> <span class="n">artifact_name</span><span class="p">)</span>

        <span class="c1"># If the caller passed an Item kref (or a Revision kref without &amp;a=), interpret it as</span>
        <span class="c1"># &quot;fetch the default artifact&quot;.</span>
        <span class="c1"># - Item kref -&gt; latest revision -&gt; default_artifact</span>
        <span class="c1"># - Revision kref -&gt; that revision -&gt; default_artifact</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_revision</span><span class="p">(</span><span class="n">kref_uri</span><span class="p">)</span>
        <span class="n">default_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">revision</span><span class="p">,</span> <span class="s2">&quot;default_artifact&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">default_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid artifact kref format: </span><span class="si">{</span><span class="n">kref_uri</span><span class="si">}</span><span class="s2"> (missing &amp;a=artifact_name and no default_artifact set)&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_artifact</span><span class="p">(</span><span class="n">revision</span><span class="o">.</span><span class="n">kref</span><span class="p">,</span> <span class="n">default_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_artifacts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revision_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Artifact</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all artifacts for a revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            revision_kref: The kref of the revision.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Artifact objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetArtifactsRequest</span><span class="p">(</span><span class="n">revision_kref</span><span class="o">=</span><span class="n">revision_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">())</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetArtifacts</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Artifact</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">artifacts</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_artifacts_by_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Artifact</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all artifacts at a specific location.</span>

<span class="sd">        Args:</span>
<span class="sd">            location: The location to search for artifacts.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Artifact objects at the location.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetArtifactsByLocationRequest</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetArtifactsByLocation</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Artifact</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">artifacts</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete an artifact.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the artifact to delete.</span>
<span class="sd">            force: Whether to force deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteArtifactRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteArtifact</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the deprecated status of a node (Item, Revision, Artifact).</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the node.</span>
<span class="sd">            deprecated: True to deprecate, False to un-deprecate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">SetDeprecatedRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">deprecated</span><span class="o">=</span><span class="n">deprecated</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">SetDeprecated</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_artifact_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Artifact</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metadata for an artifact.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the artifact.</span>
<span class="sd">            metadata: The metadata to update.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The updated Artifact object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">UpdateMetadataRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">UpdateArtifactMetadata</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Artifact</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_tenant_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current tenant&#39;s usage and limits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing node_count, node_limit, and tenant_id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetTenantUsageRequest</span><span class="p">()</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetTenantUsage</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MessageToDict</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">preserving_proto_field_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">always_print_fields_with_no_presence</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolves a Kref to a file location using the server-side ResolveLocation RPC.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            kref: The Kref URI to resolve. Can include query parameters like ?r=, ?t=, ?time=.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            The resolved file location string, or None if resolution fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Parse tag/time from kref if present to pass explicitly</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">if</span> <span class="s1">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">kref</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">kref</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;t=&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tag=&#39;</span><span class="p">):</span>
                        <span class="n">tag</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;time=&#39;</span><span class="p">):</span>
                        <span class="n">time</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">req</span> <span class="o">=</span> <span class="n">ResolveLocationRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">ResolveLocation</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">location</span>
        <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Attribute methods (granular metadata operations)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a single metadata attribute on any entity.</span>

<span class="sd">        This allows granular updates to metadata without replacing the entire</span>
<span class="sd">        metadata map. The attribute key cannot be a reserved system field.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the entity (Revision, Item, Artifact, or Space).</span>
<span class="sd">            key: The attribute key to set.</span>
<span class="sd">            value: The attribute value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the attribute was set successfully.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the entity is not found or the key is reserved.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client.set_attribute(revision.kref, &quot;render_engine&quot;, &quot;cycles&quot;)</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">SetAttributeRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">success</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a single metadata attribute from any entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the entity (Revision, Item, Artifact, or Space).</span>
<span class="sd">            key: The attribute key to retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The attribute value if it exists, None otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the entity is not found.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client.get_attribute(revision.kref, &quot;render_engine&quot;)</span>
<span class="sd">            &quot;cycles&quot;</span>
<span class="sd">            &gt;&gt;&gt; client.get_attribute(revision.kref, &quot;nonexistent&quot;)</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetAttributeRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetAttribute</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">exists</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a single metadata attribute from any entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref of the entity (Revision, Item, Artifact, or Space).</span>
<span class="sd">            key: The attribute key to delete.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the attribute was deleted successfully.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the entity is not found or the key is reserved.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; client.delete_attribute(revision.kref, &quot;deprecated_field&quot;)</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteAttributeRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteAttribute</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">success</span>

    <span class="c1"># Edge methods</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_edge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_revision</span><span class="p">:</span> <span class="n">Revision</span><span class="p">,</span>
        <span class="n">target_revision</span><span class="p">:</span> <span class="n">Revision</span><span class="p">,</span>
        <span class="n">edge_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Edge</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an edge between two revisions.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_revision: The source revision of the edge.</span>
<span class="sd">            target_revision: The target revision of the edge.</span>
<span class="sd">            edge_type: The type of relationship (e.g., kumiho.EdgeType.DEPENDS_ON).</span>
<span class="sd">                       See kumiho.EdgeType for standard types.</span>
<span class="sd">                       Must be UPPERCASE with letters, digits, underscores only.</span>
<span class="sd">            metadata: Optional metadata for the edge.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created Edge object.</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            EdgeTypeValidationError: If edge_type is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.edge</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_edge_type</span>
        <span class="n">validate_edge_type</span><span class="p">(</span><span class="n">edge_type</span><span class="p">)</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateEdgeRequest</span><span class="p">(</span>
            <span class="n">source_revision_kref</span><span class="o">=</span><span class="n">source_revision</span><span class="o">.</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">target_revision_kref</span><span class="o">=</span><span class="n">target_revision</span><span class="o">.</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">edge_type</span><span class="o">=</span><span class="n">edge_type</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateEdge</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="c1"># Construct Edge object client-side since RPC returns only status</span>
        <span class="n">pb_edge</span> <span class="o">=</span> <span class="n">PbEdge</span><span class="p">(</span>
            <span class="n">source_kref</span><span class="o">=</span><span class="n">source_revision</span><span class="o">.</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">target_kref</span><span class="o">=</span><span class="n">target_revision</span><span class="o">.</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">edge_type</span><span class="o">=</span><span class="n">edge_type</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Edge</span><span class="p">(</span><span class="n">pb_edge</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">edge_type_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Edge</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get edges associated with a kref.</span>

<span class="sd">        Args:</span>
<span class="sd">            kref: The kref to get edges for.</span>
<span class="sd">            edge_type_filter: Optional filter for edge types.</span>
<span class="sd">            direction: The direction of edges to retrieve (0=OUTGOING, 1=INCOMING, 2=BOTH).</span>
<span class="sd">                       See kumiho.EdgeDirection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of Edge objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetEdgesRequest</span><span class="p">(</span><span class="n">kref</span><span class="o">=</span><span class="n">kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span> <span class="n">edge_type_filter</span><span class="o">=</span><span class="n">edge_type_filter</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetEdges</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Edge</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">pb</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">edges</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">target_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span> <span class="n">edge_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete an edge between revisions.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_kref: The source revision kref.</span>
<span class="sd">            target_kref: The target revision kref.</span>
<span class="sd">            edge_type: The type of edge to delete.</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            EdgeTypeValidationError: If edge_type is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.edge</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_edge_type</span>
        <span class="n">validate_edge_type</span><span class="p">(</span><span class="n">edge_type</span><span class="p">)</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">DeleteEdgeRequest</span><span class="p">(</span>
            <span class="n">source_kref</span><span class="o">=</span><span class="n">source_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">target_kref</span><span class="o">=</span><span class="n">target_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">edge_type</span><span class="o">=</span><span class="n">edge_type</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">DeleteEdge</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="c1"># Graph Traversal Methods</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">traverse_edges</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">origin_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">edge_type_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">include_path</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;TraversalResult&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Traverse edges transitively from an origin revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            origin_kref: The starting revision kref.</span>
<span class="sd">            direction: Traversal direction (0=OUTGOING, 1=INCOMING, 2=BOTH).</span>
<span class="sd">            edge_type_filter: Filter by edge types (empty = all).</span>
<span class="sd">            max_depth: Maximum traversal depth (default: 10, max: 20).</span>
<span class="sd">            limit: Maximum results to return (default: 100, max: 1000).</span>
<span class="sd">            include_path: Whether to include full path information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TraversalResult containing discovered revisions and paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.edge</span><span class="w"> </span><span class="kn">import</span> <span class="n">TraversalResult</span><span class="p">,</span> <span class="n">RevisionPath</span><span class="p">,</span> <span class="n">PathStep</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">TraverseEdgesRequest</span><span class="p">(</span>
            <span class="n">origin_kref</span><span class="o">=</span><span class="n">origin_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
            <span class="n">edge_type_filter</span><span class="o">=</span><span class="n">edge_type_filter</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">include_path</span><span class="o">=</span><span class="n">include_path</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">TraverseEdges</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="n">revision_krefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Kref</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">revision_krefs</span><span class="p">]</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">PathStep</span><span class="p">(</span>
                <span class="n">revision_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">revision_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">),</span>
                <span class="n">edge_type</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">edge_type</span><span class="p">,</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">depth</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">steps</span><span class="p">]</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RevisionPath</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span> <span class="n">total_depth</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">total_depth</span><span class="p">))</span>
        
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">Edge</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">pb</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">edges</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">TraversalResult</span><span class="p">(</span>
            <span class="n">revision_krefs</span><span class="o">=</span><span class="n">revision_krefs</span><span class="p">,</span>
            <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
            <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span>
            <span class="n">total_count</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">total_count</span><span class="p">,</span>
            <span class="n">truncated</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">truncated</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="bp">self</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_shortest_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">target_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">edge_type_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">all_shortest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ShortestPathResult&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the shortest path between two revisions.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_kref: The source revision kref.</span>
<span class="sd">            target_kref: The target revision kref.</span>
<span class="sd">            edge_type_filter: Filter by edge types (empty = all).</span>
<span class="sd">            max_depth: Maximum path length to search (default: 10).</span>
<span class="sd">            all_shortest: Return all shortest paths, not just one.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ShortestPathResult containing path(s) if found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.edge</span><span class="w"> </span><span class="kn">import</span> <span class="n">RevisionPath</span><span class="p">,</span> <span class="n">PathStep</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">ShortestPathRequest</span><span class="p">(</span>
            <span class="n">source_kref</span><span class="o">=</span><span class="n">source_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">target_kref</span><span class="o">=</span><span class="n">target_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">edge_type_filter</span><span class="o">=</span><span class="n">edge_type_filter</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
            <span class="n">all_shortest</span><span class="o">=</span><span class="n">all_shortest</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">FindShortestPath</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">PathStep</span><span class="p">(</span>
                <span class="n">revision_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">revision_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">),</span>
                <span class="n">edge_type</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">edge_type</span><span class="p">,</span>
                <span class="n">depth</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">depth</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">steps</span><span class="p">]</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RevisionPath</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span> <span class="n">total_depth</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">total_depth</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">ShortestPathResult</span><span class="p">(</span>
            <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">,</span>
            <span class="n">path_exists</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">path_exists</span><span class="p">,</span>
            <span class="n">path_length</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">path_length</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_impact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">revision_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">edge_type_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s1">&#39;ImpactedRevision&#39;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze what would be impacted by changes to a revision.</span>

<span class="sd">        Finds all revisions that directly or indirectly depend on the</span>
<span class="sd">        given revision.</span>

<span class="sd">        Args:</span>
<span class="sd">            revision_kref: The revision to analyze impact for.</span>
<span class="sd">            edge_type_filter: Filter by edge types (default: DEPENDS_ON).</span>
<span class="sd">            max_depth: Maximum traversal depth (default: 10).</span>
<span class="sd">            limit: Maximum results (default: 100).</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of ImpactedRevision objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.edge</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpactedRevision</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">ImpactAnalysisRequest</span><span class="p">(</span>
            <span class="n">revision_kref</span><span class="o">=</span><span class="n">revision_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">edge_type_filter</span><span class="o">=</span><span class="n">edge_type_filter</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">AnalyzeImpact</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">ImpactedRevision</span><span class="p">(</span>
                <span class="n">revision_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">iv</span><span class="o">.</span><span class="n">revision_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">),</span>
                <span class="n">item_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">iv</span><span class="o">.</span><span class="n">item_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span> <span class="k">if</span> <span class="n">iv</span><span class="o">.</span><span class="n">item_kref</span><span class="o">.</span><span class="n">uri</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">impact_depth</span><span class="o">=</span><span class="n">iv</span><span class="o">.</span><span class="n">impact_depth</span><span class="p">,</span>
                <span class="n">impact_path_types</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">iv</span><span class="o">.</span><span class="n">impact_path_types</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">iv</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">impacted_revisions</span>
        <span class="p">]</span>

    <span class="c1"># Bundle Methods</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_bundle</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">bundle_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Bundle&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new bundle item.</span>

<span class="sd">        Bundles are special items that aggregate other items.</span>
<span class="sd">        The ``bundle`` kind is reserved and can only be created</span>
<span class="sd">        through this method (not via :meth:`create_item`).</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.project.Project.create_bundle` or</span>
<span class="sd">            :meth:`~kumiho.space.Space.create_bundle` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_path: The path to the parent space (e.g., ``/project/space``).</span>
<span class="sd">            bundle_name: The name of the bundle. Must be unique within</span>
<span class="sd">                the parent space.</span>
<span class="sd">            metadata: Optional key-value metadata for the bundle.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Bundle: The created Bundle object with ``kind=&#39;bundle&#39;``.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the bundle name is already taken or connection fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.bundle</span><span class="w"> </span><span class="kn">import</span> <span class="n">Bundle</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">CreateBundleRequest</span><span class="p">(</span>
            <span class="n">parent_path</span><span class="o">=</span><span class="n">parent_path</span><span class="p">,</span>
            <span class="n">bundle_name</span><span class="o">=</span><span class="n">bundle_name</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">CreateBundle</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Bundle</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_bundle_member</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bundle_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">member_item_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Revision</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an item to a bundle.</span>

<span class="sd">        Creates a new revision of the bundle to track the change with</span>
<span class="sd">        full audit trail.</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.bundle.Bundle.add_member` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_kref: The kref pointing to the bundle item.</span>
<span class="sd">            member_item_kref: The kref pointing to the item to add.</span>
<span class="sd">            metadata: Optional key-value metadata to store in the revision.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[bool, str, Optional[Revision]]: A tuple containing:</span>
<span class="sd">                - success: Whether the operation succeeded.</span>
<span class="sd">                - message: Status message (e.g., &quot;Added&quot; or error details).</span>
<span class="sd">                - new_revision: The new bundle revision, or None on failure.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the bundle or member item is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">AddBundleMemberRequest</span><span class="p">(</span>
            <span class="n">bundle_kref</span><span class="o">=</span><span class="n">bundle_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">member_item_kref</span><span class="o">=</span><span class="n">member_item_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">AddBundleMember</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">new_revision</span> <span class="o">=</span> <span class="n">Revision</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">new_revision</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">new_revision</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">new_revision</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_bundle_member</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bundle_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">member_item_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Revision</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove an item from a bundle.</span>

<span class="sd">        Creates a new revision of the bundle to track the change with</span>
<span class="sd">        full audit trail.</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.bundle.Bundle.remove_member` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_kref: The kref pointing to the bundle item.</span>
<span class="sd">            member_item_kref: The kref pointing to the item to remove.</span>
<span class="sd">            metadata: Optional key-value metadata to store in the revision.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[bool, str, Optional[Revision]]: A tuple containing:</span>
<span class="sd">                - success: Whether the operation succeeded.</span>
<span class="sd">                - message: Status message (e.g., &quot;Removed&quot; or error details).</span>
<span class="sd">                - new_revision: The new bundle revision, or None on failure.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the bundle or member item is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">RemoveBundleMemberRequest</span><span class="p">(</span>
            <span class="n">bundle_kref</span><span class="o">=</span><span class="n">bundle_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">member_item_kref</span><span class="o">=</span><span class="n">member_item_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">RemoveBundleMember</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="n">new_revision</span> <span class="o">=</span> <span class="n">Revision</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">new_revision</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">new_revision</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">new_revision</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_bundle_members</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bundle_kref</span><span class="p">:</span> <span class="n">Kref</span><span class="p">,</span>
        <span class="n">revision_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s1">&#39;BundleMember&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all members of a bundle.</span>

<span class="sd">        Retrieves the list of items that belong to a bundle at</span>
<span class="sd">        a specific revision (or the latest revision if not specified).</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.bundle.Bundle.get_members` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_kref: The kref pointing to the bundle item.</span>
<span class="sd">            revision_number: Optional specific revision to query. If not provided,</span>
<span class="sd">                returns members from the latest revision.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[BundleMember], int, int]: A tuple containing:</span>
<span class="sd">                - members: List of :class:`~kumiho.bundle.BundleMember` objects.</span>
<span class="sd">                - revision_number: The revision number queried.</span>
<span class="sd">                - total_count: Total number of members.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the bundle is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.bundle</span><span class="w"> </span><span class="kn">import</span> <span class="n">BundleMember</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetBundleMembersRequest</span><span class="p">(</span>
            <span class="n">bundle_kref</span><span class="o">=</span><span class="n">bundle_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">(),</span>
            <span class="n">revision_number</span><span class="o">=</span><span class="n">revision_number</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetBundleMembers</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="n">members</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">BundleMember</span><span class="p">(</span>
                <span class="n">item_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">item_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">),</span>
                <span class="n">added_at</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">added_at</span><span class="p">,</span>
                <span class="n">added_by</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">added_by</span><span class="p">,</span>
                <span class="n">added_by_username</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">added_by_username</span><span class="p">,</span>
                <span class="n">added_in_revision</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">added_in_revision</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">members</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">members</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">revision_number</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">total_count</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_bundle_history</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bundle_kref</span><span class="p">:</span> <span class="n">Kref</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s1">&#39;BundleRevisionHistory&#39;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the history of changes to a bundle&#39;s membership.</span>

<span class="sd">        Returns a chronological list of membership changes (adds/removes)</span>
<span class="sd">        with full audit trail including author information and timestamps.</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a low-level client method. Prefer using</span>
<span class="sd">            :meth:`~kumiho.bundle.Bundle.get_history` for a higher-level API.</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_kref: The kref pointing to the bundle item.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[BundleRevisionHistory]: List of</span>
<span class="sd">                :class:`~kumiho.bundle.BundleRevisionHistory` objects</span>
<span class="sd">                documenting each membership change.</span>

<span class="sd">        Raises:</span>
<span class="sd">            grpc.RpcError: If the bundle is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.bundle</span><span class="w"> </span><span class="kn">import</span> <span class="n">BundleRevisionHistory</span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetBundleHistoryRequest</span><span class="p">(</span>
            <span class="n">bundle_kref</span><span class="o">=</span><span class="n">bundle_kref</span><span class="o">.</span><span class="n">to_pb</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetBundleHistory</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">BundleRevisionHistory</span><span class="p">(</span>
                <span class="n">revision_number</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">revision_number</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
                <span class="n">member_item_kref</span><span class="o">=</span><span class="n">Kref</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">member_item_kref</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span> <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">member_item_kref</span><span class="o">.</span><span class="n">uri</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">author</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                <span class="n">created_at</span><span class="o">=</span><span class="n">h</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">history</span>
        <span class="p">]</span>

    <span class="c1"># Event Streaming</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">event_stream</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">routing_key_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">kref_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">consumer_group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">from_beginning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Event</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subscribe to the event stream from the Kumiho server.</span>

<span class="sd">        Args:</span>
<span class="sd">            routing_key_filter: A filter for the events to receive.</span>
<span class="sd">                                Supports wildcards, e.g., &quot;item.model.*&quot;</span>
<span class="sd">            kref_filter: A filter for the kref URIs to receive events for.</span>
<span class="sd">                        Supports wildcards, e.g., &quot;kref://projectA/**/*.model&quot;</span>
<span class="sd">            cursor: Resume from a previous cursor position (Creator tier+).</span>
<span class="sd">                    Pass the cursor from the last received event to continue</span>
<span class="sd">                    from that point after reconnection.</span>
<span class="sd">            consumer_group: Consumer group name for load-balanced delivery</span>
<span class="sd">                           (Enterprise tier only). Multiple consumers in the</span>
<span class="sd">                           same group each receive different events.</span>
<span class="sd">            from_beginning: Start from earliest available events instead of</span>
<span class="sd">                           live-only (Creator tier+, subject to retention).</span>
<span class="sd">            timeout: Optional timeout in seconds for the gRPC stream.</span>
<span class="sd">                    If reached, the iterator will raise grpc.RpcError with</span>
<span class="sd">                    StatusCode.DEADLINE_EXCEEDED.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Event objects representing changes in the database. Each event</span>
<span class="sd">            includes a ``cursor`` field that can be saved for resumption.</span>

<span class="sd">        Example::</span>

<span class="sd">            last_cursor = load_cursor_from_disk()  # Load previous position</span>
<span class="sd">            try:</span>
<span class="sd">                for event in client.event_stream(</span>
<span class="sd">                    routing_key_filter=&quot;revision.*&quot;,</span>
<span class="sd">                    cursor=last_cursor,</span>
<span class="sd">                    timeout=30</span>
<span class="sd">                ):</span>
<span class="sd">                    process_event(event)</span>
<span class="sd">                    save_cursor_to_disk(event.cursor)  # Save for next run</span>
<span class="sd">            except grpc.RpcError as e:</span>
<span class="sd">                if e.code() == grpc.StatusCode.DEADLINE_EXCEEDED:</span>
<span class="sd">                    print(&quot;Stream timed out&quot;)</span>
<span class="sd">                else:</span>
<span class="sd">                    raise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">EventStreamRequest</span><span class="p">(</span>
            <span class="n">routing_key_filter</span><span class="o">=</span><span class="n">routing_key_filter</span><span class="p">,</span>
            <span class="n">kref_filter</span><span class="o">=</span><span class="n">kref_filter</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">cursor</span>
        <span class="k">if</span> <span class="n">consumer_group</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">consumer_group</span> <span class="o">=</span> <span class="n">consumer_group</span>
        <span class="k">if</span> <span class="n">from_beginning</span><span class="p">:</span>
            <span class="n">req</span><span class="o">.</span><span class="n">from_beginning</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">for</span> <span class="n">pb_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">EventStream</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Event</span><span class="p">(</span><span class="n">pb_event</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_event_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;EventCapabilities&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get event streaming capabilities for the current tenant tier.</span>

<span class="sd">        Returns the capabilities available based on the authenticated tenant&#39;s</span>
<span class="sd">        subscription tier. Use this to determine which features are available</span>
<span class="sd">        before using cursor-based resume or consumer groups.</span>

<span class="sd">        Returns:</span>
<span class="sd">            EventCapabilities with the following attributes:</span>
<span class="sd">                - supports_replay: Can replay past events</span>
<span class="sd">                - supports_cursor: Can resume from cursor</span>
<span class="sd">                - supports_consumer_groups: Can use consumer groups (Enterprise)</span>
<span class="sd">                - max_retention_hours: Event retention period (-1 = unlimited)</span>
<span class="sd">                - max_buffer_size: Max events in buffer (-1 = unlimited)</span>
<span class="sd">                - tier: Tier name (free, creator, studio, enterprise)</span>

<span class="sd">        Example::</span>

<span class="sd">            caps = client.get_event_capabilities()</span>
<span class="sd">            if caps.supports_cursor:</span>
<span class="sd">                # Use cursor-based streaming</span>
<span class="sd">                last_cursor = load_saved_cursor()</span>
<span class="sd">                for event in client.event_stream(cursor=last_cursor):</span>
<span class="sd">                    ...</span>
<span class="sd">            else:</span>
<span class="sd">                # Free tier - no cursor support</span>
<span class="sd">                for event in client.event_stream():</span>
<span class="sd">                    ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.event</span><span class="w"> </span><span class="kn">import</span> <span class="n">EventCapabilities</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">GetEventCapabilitiesRequest</span><span class="p">()</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stub</span><span class="o">.</span><span class="n">GetEventCapabilities</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">EventCapabilities</span><span class="p">(</span>
            <span class="n">supports_replay</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">supports_replay</span><span class="p">,</span>
            <span class="n">supports_cursor</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">supports_cursor</span><span class="p">,</span>
            <span class="n">supports_consumer_groups</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">supports_consumer_groups</span><span class="p">,</span>
            <span class="n">max_retention_hours</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">max_retention_hours</span><span class="p">,</span>
            <span class="n">max_buffer_size</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">max_buffer_size</span><span class="p">,</span>
            <span class="n">tier</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">tier</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_ClientCallDetails</span><span class="p">(</span><span class="n">grpc</span><span class="o">.</span><span class="n">ClientCallDetails</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mutable wrapper that lets us override metadata on outbound RPCs.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">grpc</span><span class="o">.</span><span class="n">CallCredentials</span><span class="p">],</span>
        <span class="n">wait_for_ready</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
        <span class="n">compression</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">grpc</span><span class="o">.</span><span class="n">Compression</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">tuple</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">)</span> <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_ready</span> <span class="o">=</span> <span class="n">wait_for_ready</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">compression</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_augment_call_details</span><span class="p">(</span>
    <span class="n">client_call_details</span><span class="p">:</span> <span class="n">grpc</span><span class="o">.</span><span class="n">ClientCallDetails</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ClientCallDetails</span><span class="p">:</span>
    <span class="n">existing</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">[]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">existing</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">existing</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">existing</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
    <span class="n">existing</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_ClientCallDetails</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">existing</span><span class="p">,</span>
        <span class="n">credentials</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">credentials</span><span class="p">,</span>
        <span class="n">wait_for_ready</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="s2">&quot;wait_for_ready&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">compression</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_MetadataInjector</span><span class="p">(</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryUnaryClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryStreamClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">StreamUnaryClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">StreamStreamClientInterceptor</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Client interceptor that injects static metadata such as auth tokens.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Injecting metadata (keys: </span><span class="si">{</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">_augment_call_details</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">_augment_call_details</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_stream_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">_augment_call_details</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_stream_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">_augment_call_details</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_CorrelationIdInterceptor</span><span class="p">(</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryUnaryClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryStreamClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">StreamUnaryClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">StreamStreamClientInterceptor</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Client interceptor that generates a unique correlation ID per request.</span>
<span class="sd">    </span>
<span class="sd">    This enables end-to-end tracing across Control Plane and Data Plane.</span>
<span class="sd">    The correlation ID is sent as the &#39;x-correlation-id&#39; header.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_correlation_id</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;kumiho-</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_correlation_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">):</span>
        <span class="n">correlation_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_correlation_id</span><span class="p">()</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding correlation ID: </span><span class="si">{</span><span class="n">correlation_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_augment_call_details</span><span class="p">(</span>
            <span class="n">client_call_details</span><span class="p">,</span> 
            <span class="p">[(</span><span class="s2">&quot;x-correlation-id&quot;</span><span class="p">,</span> <span class="n">correlation_id</span><span class="p">)]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_correlation_id</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_correlation_id</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_stream_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_correlation_id</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_stream_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_correlation_id</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated</span><span class="p">,</span> <span class="n">request_iterator</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_AutoLoginInterceptor</span><span class="p">(</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryUnaryClientInterceptor</span><span class="p">,</span>
    <span class="n">grpc</span><span class="o">.</span><span class="n">UnaryStreamClientInterceptor</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Client interceptor that automatically prompts for login on auth failures.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">continuation</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        
        <span class="c1"># Check if this is an auth error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Force the response to be evaluated</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">):</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span><span class="p">()</span>
                <span class="n">should_refresh</span> <span class="o">=</span> <span class="kc">False</span>
                
                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">UNAUTHENTICATED</span><span class="p">,</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">PERMISSION_DENIED</span><span class="p">):</span>
                    <span class="n">should_refresh</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">UNAVAILABLE</span><span class="p">:</span>
                    <span class="c1"># Handle JWKS errors which often manifest as UNAVAILABLE</span>
                    <span class="n">details</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">details</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">details</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;jwks&quot;</span> <span class="ow">in</span> <span class="n">details</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;kid&quot;</span> <span class="ow">in</span> <span class="n">details</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                        <span class="n">should_refresh</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">should_refresh</span><span class="p">:</span>
                    <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Authentication error detected, prompting for login...&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">auth_cli</span>
                        <span class="n">new_token</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">auth_cli</span><span class="o">.</span><span class="n">ensure_token</span><span class="p">(</span><span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        
                        <span class="c1"># Update the authorization header with the new token</span>
                        <span class="n">existing_metadata</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">[]):</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                                <span class="n">existing_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                                <span class="n">existing_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># memoryview or other buffer-like object</span>
                                <span class="n">existing_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
                        <span class="c1"># Remove old authorization header</span>
                        <span class="n">existing_metadata</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">existing_metadata</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;authorization&quot;</span><span class="p">]</span>
                        <span class="c1"># Add new token</span>
                        <span class="n">existing_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;authorization&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">new_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
                        
                        <span class="n">updated_details</span> <span class="o">=</span> <span class="n">_ClientCallDetails</span><span class="p">(</span>
                            <span class="n">method</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
                            <span class="n">timeout</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
                            <span class="n">metadata</span><span class="o">=</span><span class="n">existing_metadata</span><span class="p">,</span>
                            <span class="n">credentials</span><span class="o">=</span><span class="n">client_call_details</span><span class="o">.</span><span class="n">credentials</span><span class="p">,</span>
                            <span class="n">wait_for_ready</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="s2">&quot;wait_for_ready&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                            <span class="n">compression</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="p">)</span>
                        
                        <span class="c1"># Retry the RPC with the new token</span>
                        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Retrying RPC with refreshed credentials&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">updated_details</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Auto-login failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">response</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># If we can&#39;t check the error, just return the original response</span>
            <span class="k">pass</span>
        
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intercept_unary_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">continuation</span><span class="p">,</span> <span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># For streaming responses, we can&#39;t easily retry, so just pass through</span>
        <span class="c1"># The first error will be caught and user will be prompted to re-run</span>
        <span class="k">return</span> <span class="n">continuation</span><span class="p">(</span><span class="n">client_call_details</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Kumiho Clouds.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>